/*jshint esversion: 6 */
/*jshint ignore:start */
var pjson=require("./package.json"),GLOUPS_VERSION=pjson.version;process.title="Gloups "+GLOUPS_VERSION+" | Chears !";var gulp=require("gulp"),chalk=require("chalk"),M={autoprefixer:"gulp-autoprefixer",cleanCSS:"gulp-clean-css",clear:"clear",coffee:"gulp-coffee",concat:"gulp-concat",del:"del",exit:"gulp-exit",fs:"fs",fssync:"fs-sync",insert:"gulp-insert",jsValidate:"gulp-jsvalidate",lazyPipe:"lazypipe",less:"gulp-less",nop:"gulp-nop",path:"path",rename:"gulp-rename",replace:"gulp-replace",sass:"gulp-sass",sourcemaps:"gulp-sourcemaps",stylefmt:"gulp-stylefmt",stylus:"gulp-stylus",through:"through2",ts:"gulp-typescript",uglify:"gulp-uglifyes",wait:"gulp-wait"},SERVICES={t:"typescript",c:"coffeescript",s1:"less",s2:"sass",s3:"stylus",minj:"automin",minc:"autominCss",tr:"transitive",es:"essential",a:"all",all:"automin typescript coffeescript autominCss less sass stylus",styles:"autominCss less sass stylus",js:"automin typescript coffeescript"},PRESET_OPTIONS="all|styles|js",SERVICES_OPTIONS="automin|autominCss|typescript|coffeescript|less|sass|stylus",SERVICES_ADVANCED_OPTIONS="transitive|essential",ALL_SERVICES_OPTIONS=PRESET_OPTIONS+"|"+SERVICES_OPTIONS+"|"+SERVICES_ADVANCED_OPTIONS,JS_REGEX_FILE_PATH_PATTERN="^(?:((?:[^\\.]+|..)[\\x2F\\x5C])|)((?:([^\\.^\\x2F^\\x5C]+)(?:((?:[.](?!\\bmin\\b)(?:[^\\.]+))+|))(?:([.]min)([.]js)|([.]js))))$",GLOUPS_OPTIONS=SERVICES_OPTIONS+"|"+PRESET_OPTIONS,SILENT_TASKS="watch|vet|unit-test|integration-test",ISALL=!0,isdist={},AUTOPREFIXER_BROWSERS=["> 1%","last 2 versions","firefox >= 4","safari 7","safari 8","IE 8","IE 9","IE 10","IE 11"],DEFAULT_CONFIG={verbose:!1,pathesToJs:[],pathesToTs:[],pathesToCoffee:[],pathesToStyle:[],pathesToStyleLess:[],pathesToSass:[],pathesToStylus:[],projects:[]},config=getConfig(),glob_found_modules={fs:!0},glob_visited_elements={infunc:{},intask:{}};class classReading{constructor(){this.line_=null,this.data_=null,this.iter_=null,this.stopped_=!1}initialize(e,t){this.data_=e+" ",this.iter_=t,this.line_=[]}readLines(e){for(var t;!this.stopped&&(t=this.getNextChar());)/^[\n\r]$/g.test(t)||this.isEndReached()?(this.toLine(),e(this.line),this.resetLine()):this.feed(t)}stop(){this.stopped=!0}get stopped(){return this.stopped_}set stopped(e){this.stopped_=e}get iter(){return this.iter_}set iter(e){this.iter_=e}get data(){return this.data_}set data(e){this.data_=e}get line(){return this.line_}set line(e){this.line_=e}toLine(){this.line=this.line.join(""),this.line=this.line.replace(/^[\n\r]$/g,"")}resetLine(){this.line=[]}getNextChar(){return this.data[this.iter++]}isEndReached(){return!this.data[this.iter]}feed(e){this.line_.push(e)}}String.prototype.format=function(e){return this.replace(String.prototype.format.regex,function(t){var s=parseInt(t.substring(1,t.length-1));return s>=0?e[s]:-1===s?"{":-2===s?"}":""})},String.prototype.format.regex=new RegExp("{-?[0-9]+}","g"),String.prototype.hackSlashes=function(){return this.replace(/[\\]/g,"/")};var cmd=String(process.argv[2]);if(ISALL||new RegExp("^(({0})(:.*)?)$".format([SILENT_TASKS])).test(cmd)){var isWatching=/^(watch:.*)$/.test(cmd),firstCall=!1,on=gulp.on;gulp.on=function(e,t){if(!/^(task_start|task_stop)$/.test(e)||!/gutil\.log\(\s*'(Starting|Finished)/.test(t.toString()))return on.apply(gulp,arguments)},gulp.on("start",function(){firstCall&&(isWatching&&process.stdout.write(""),firstCall=!1)}),gulp.on("stop",function(){firstCall=!0})}function getModule(e){if("string"==typeof e)for(var t in M)if(M[t]==e){var s=new Date;M[t]=require(e);var o=ms2Time(new Date-s);return isdist.NOT_DISTRIBUTION&&console.log(forNowShortLog(" {0}{1} loaded after {2}".format([chalk.bgMagenta(" M:"),chalk.bgMagenta(e+" "),chalk.magenta(o)]))),M[t]}return e}var logOrig=console.log;function gloupslog(e){logOrig(e)}var mayLogEssentials=metAllArgs(["essential"]);function runTaskProcessForCompression(e,t,s){logTaskPurpose(e.currentTask.name);var o=createMainLazyPipeObject(t,"Compressed    ",s.module),n=watchList(t);gulp.watch(n,function(e){var n=e.path;if(checkMultipleRules(n,["deleted"!==e.type].concat(s.rules))){o.forMatchingObj.path=n;var i=getMatchingEntryConfig(n,t);o.pathesDescr=i,o.process=s.mainPipe,o.source_kind="simple",consumePipeProcss(null,o,[n])}})}function runTaskProcessForPrecompiledFiles(e,t,s){logTaskPurpose(e.currentTask.name);var o=createMainLazyPipeObject(t,"Processed     ",s.module),n=watchList(t),i=getFreshTransitivity();gulp.watch(n,function(e){var n=e.path;if(checkMultipleRules(n,s.rules)){o.forMatchingObj.path=n;var a=getMatchingEntryConfig(n,t);o.process=s.mainPipe;var r=s.realTargetsFunction(n,a);o.source_kind="complex",consumePipeProcss(i,o,r)}})}function consumePipeProcss(e,t,s){var o=transitiveAndSourcemappingWrap(e,t);t.destCallBack=function(o){return o&&(gloupslog(""),logChangedRealTargetedFiles(t,s)),null!=e?e.dest:t.pathesDescr.dest},gulp.src(s).pipe(o()).pipe(applyLicenceSplitting(t)).pipe(gulp.dest(t.destCallBack(!0)))}function transitiveAndSourcemappingWrap(e,t){var s=t.forMatchingObj,o=s.path,n=s.pathesDescr,i=t.message,a=getMatchingEntryConfig(o,n);return setSourceMappingAndSign(transitiveWrapAround(e,a,o,t),a,i)}function setSourceMappingAndSign(e,t,s){var o=t.sourcemaps;return getModule(M.lazyPipe)().pipe(o?getModule(M.sourcemaps).init:getModule(M.nop)).pipe(e).pipe(insertSignatureAfter,s.action,s.module).pipe(o?function(){return getModule(M.sourcemaps).write("./")}:getModule(M.nop))}function transitiveWrapAround(e,t,s,o){return null!=e&&"draft"==e.dest&&transitivitySetupCore(e,t,s),applyLazyPipeSet({opening:null!=e?getModule(M.lazyPipe)().pipe(transitivitySetup,e,t,s):getModule(M.nop),closing:null!=e?getModule(M.lazyPipe)().pipe(e.suffixing).pipe(e.compressing):getModule(M.nop),main:o})}function applyLazyPipeSet(e){var t=e.main.process,s=e.main.source_kind;if("simple"==s)return getModule(M.lazyPipe)().pipe(e.opening).pipe(lisencesSetup(t)).pipe(separateLisences(t)).pipe(t).pipe(separatePrehamptedLisences(t)).pipe(e.closing);if("complex"==s){var o=metAllArgs(["transitive"]);return getModule(M.lazyPipe)().pipe(e.opening).pipe(lisencesSetup(t)).pipe(t).pipe(separateLisences(t,o)).pipe(e.closing)}}function transitivitySetup(e,t,s){return getModule(M.through).obj(function(o,n,i){transitivitySetupCore(e,t,s),i(null,o)})}function transitivitySetupCore(e,t,s){var o=metAllArgs(["all","transitive"])||metAllArgs(["sass","autominCss","transitive"])||metAllArgs(["stylus","autominCss","transitive"])||metAllArgs(["less","autominCss","transitive"])||metAllArgs(["coffeescript","automin","transitive"])||metAllArgs(["typescript","automin","transitive"]),n=!1;if(e.dest=t.dest,o){var i=/^.*[\/](.*)$/g.exec(s.hackSlashes())[1],a="{0}/{1}".format([t.dest,i]),r=/.*[.](coffee|ts)$/.test(i)?"JS":/.*[.](scss|styl|less)$/.test(i)?"CSS":"UNDEFINED",l=getMatchingEntryConfig(a,"JS"==r?config.pathesToJs:"CSS"==r?config.pathesToStyle:null);n=null!=l,e.should=n,n&&(e.compressing="JS"==r?getModule(M.uglify):"CSS"==r?cleanCssMinification:getModule(M.nop),e.suffixing=renameSuffixMin,e.dest=l.dest)}}function renameSuffixMin(){return getModule(M.rename)({suffix:".min"})}function cleanCssMinification(){return getModule(M.cleanCSS)({compatibility:"ie8"})}function insertSignatureAfter(e,t){return getModule(M.insert).append("\n/* -- {1} wth Gloups v {2} - {3} | thanks to {4} -- */".format([e.replace(/[\s]+$/,""),GLOUPS_VERSION,shortDateComputed(),t]))}function autoprefix(){return getModule(M.autoprefixer)({browsers:AUTOPREFIXER_BROWSERS,cascade:!1})}function getConfig(){return config||DEFAULT_CONFIG}function readJsonConfig(e){var t,s,o=getModule(M.fs).readFileSync(e,"utf8"),n=new classReading;n.initialize(o,0);var i=0,a=!0,r="",l=(t=/^(.*)(\.json)$/.exec(e))[1]+".temp"+t[2],c=t[1]+"2.temp"+t[2];getModule(M.fssync).write(l,"","utf8"),n.readLines(function(){s=n.line,(a=t=/^(.*)\/\/.*$/g.exec(s))?r=t[1]:(a=t=/^(.*)\/\*$/g.exec(s))?(r=t[1],++i):(a=t=/^.*\*\/(.*)$/g.exec(s))?(r=t[1],--i):(a=0==i)&&(r=s),a&&(/^[\s]*$/g.test(r)||(getModule(M.fs).appendFileSync(c,r+"\r\n","utf8"),getModule(M.fs).appendFileSync(l,/^[\s\t]*((?:[^\s\t]*[\s\t]*[^\s\t])+)[\s\t]*$/.exec(r)[1],"utf8")))});var g=getModule(M.fs).readFileSync(l,"utf8");return getModule(M.fssync).remove(l),getModule(M.fssync).remove(c),JSON.parse(g.replace(/}(,)]/g,"}]"))}function setConfig(){config.projects=readJsonConfig("custom/config.json").projects}function makePathesCoveringAllFilesFor(e,t,s,o){var n=t.addon,i=t.pathesToService;if(t.projectPath=e,n){for(var a=0,r=n.length;a<r;++a){n[a].watch=n[a].watch+s;n[a].watch,n[a].dest;0<a&&(o="[SAME-PURPOSE]");var l=getProjectNameFromRootPath(e);logServiceActivatedPushed(o,l,n[a]),n[a].watch=e+"/"+n[a].watch,n[a].dest=e+"/"+n[a].dest,n[a].projectPath=e,n[a].projectName=l,i=i.concat(n[a])}config.verbose&&console.log()}return i}function setUpProjectWatchingPaths(e){var t=readJsonConfig(e+"/config.mzg.json");console.log("Activated Services for target project under the path [FOLDER]:"),console.log(logFilePath(e)+"\n"),config.pathesToJs=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToJs,addon:t.minify_js},"/**/*.js","Compress .js files into .min.js files"),config.pathesToTs=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToTs,addon:t.ts_to_js},"/**/*.ts","Compile .ts files into .js file"),config.pathesToCoffee=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToCoffee,addon:t.coffee_to_js},"/**/*.coffee","Compile .coffee files into .js file"),config.pathesToStyle=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStyle,addon:t.minify_css},"/**/*.css","Compress .css files"),config.pathesToStyleLess=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStyleLess,addon:t.less},"/**/*.less","Compile .less files into .css files"),config.pathesToSass=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToSass,addon:t.sass},"/**/*.scss","Compile .scss files into .css files"),config.pathesToStylus=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStylus,addon:t.stylus},"/**/*.styl","Compile .styl files into .css files")}function getMatchingEntryConfig(e,t){for(var s in e=e.hackSlashes(),t){var o=t[s],n=o.watch.hackSlashes(),i=(o.dest.hackSlashes(),new RegExp("^([^\\\\/*]+).([^\\*]+)([\\/]?[\\/*]+[\\/]?)(.*)$","g").exec(n)[2]);if(new RegExp("^.*(?:"+i+").*$","g").exec(e))return o}return null}function watchList(e){var t=[];for(var s in e){var o=e[s].watch;t.push(o)}return t}function watchListLight(e){var t=[];return e.forEach(function(e){var s=e.watch,o=e.projectPath.length,n=s.substr(o);t.push({project:e.projectName,watch:n})}),t}function mappSassMatching(e,t){var s;if((s=/^(.*)[\\\/]\*\*[\\\/]\*\..*$/.exec(t))&&s[1]){config.sassMaching=[];var o=0;walkSync(s[1],[],new RegExp("^.*[\\/](_.*)$","i")).forEach(function(t){config.sassMaching.push({identifier:t.fileName,target:t.path,partials:[]}),pushEllipsizedPartials(e,t,o++)})}}function pushEllipsizedPartials(e,t,s){var o=new classReading,n=getModule(M.fs).readFileSync(t.path,"utf8");o.initialize(n,0);var i,a,r=e.length;o.readLines(function(){if(i=o.line,(a=/^@import[\s].*["](.*)["]/.exec(i))&&a[1]){var e="{0}/{1}".format([t.dir,a[1]]),n=pathEllipzizeing(e,0,e.substr(r).split("/").length);config.sassMaching[s].partials.push(n)}})}function pathEllipzizeing(e,t,s){var o="^(?:(?:((?:[^/\\]+[\\/]{-1}1,2{-2}){-1}{0}{-2}).*((?:[\\/][^/\\?]+){-1}{1},{-2}[\\/]?)[^?]*).*|([^?]*).*)$".format([t,s]),n=new RegExp(o,"g").exec(e);return n[3]?n[3]:n[1]+"..."+n[2]}mayLogEssentials&&(console.log=function(){},gloupslog(forNowShortLog(chalk.bgRed(" Logging only essential messages ")))),gulp.task("default",["setParams"]),gulp.task("clear",function(){getModule(M.clear)()}),gulp.task("setVars",function(){for(var e in setConfig(),isdist.NOT_DISTRIBUTION&&getModule(M.path),config.verbose||logTaskPurpose(this.currentTask.name),config.projects){var t=config.projects[e];getModule(M.fssync).exists(t.path+"\\config.mzg.json")?(console.log(" "+chalk.bgGreen(" "+t.project+" ")),t.checked&&setUpProjectWatchingPaths(t.path)):logProjectErrored(t)}for(e in config.pathesToSass){var s=config.pathesToSass[e].watch;mappSassMatching(config.pathesToSass[e].projectPath,s)}isdist.NOT_DISTRIBUTION&&(config.verbose||console.log(forNowLongLog("{0}\n",["config externalized under config.json"])),gulp.start("externalizeConfig")),config.verbose||(console.log(forNowLongLog("{0}\n",["config externalized under config.json"])),console.log(forNowLongLog("{0}\n",["CONFIGURATON PROCEEDED"])))}),gulp.task("setParams",function(){var e,t=this.seq.slice(-1)[0];if(/^default$/.test(t))e=tasksToRunOnArgvs(),gulp.start(e.length>0?["setVars"].concat(e):[]);else if(/^serve$/.test(t))process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Serve"]),e=tasksToRunOnArgvs(),isdist.NOT_DISTRIBUTION&&getAllNeededModules(e.concat(["setVars"])),gulp.start(e.length>0?["setVars"].concat(e):[]);else if(/^rewrite$/.test(t)){process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Rewrite"]);var s=configurationOfRewriteOnArvs(),o=!/^ugly$/.test(s.uglyness),n=!/^multiple$/.test(s.times);isdist.NOT_DISTRIBUTION&&getAllNeededModules(["rewrite","writeTemp","writeDist","applyTemp","applyDist"]),logTaskName("rewrite {0}-{1} mode".format([o?"imBeauty":"imUgly",n?"one shot":"watching"])),mergingOnChanges(o,n),(o?logTaskEndBeauty:logTaskEndUgly)(n)}}),gulp.task("helpMe",function(){logHelp()}),gulp.task("scanProjects",function(){logTaskPurpose(this.currentTask.name),setConfig(),config.projects.forEach(function(e){getModule(M.fssync).exists(e.path+"\\config.mzg.json")||(console.log("file :"+logFilePath(e.path+"\\config.mzg.json")+" does not exist ... creation very soon"),gulp.src("custom/config_model.json").pipe(getModule(M.rename)("config.mzg.json")).pipe(gulp.dest(e.path)))})}),gulp.task("serviceMapping",function(){logTaskPurpose(this.currentTask.name),config.verbose=!0,gulp.start(["setVars"])}),gulp.task("serve",["setParams"]),gulp.task("automin",function(){var e={module:"gulp-uglify",rules:[JS_REGEX_FILE_PATH_PATTERN,["!",/.*(?:.min.js|.lisence.js)$/]],lisences:null,mainPipe:null};e.mainPipe=getModule(M.lazyPipe)().pipe(getModule(M.uglify)).pipe(renameSuffixMin),runTaskProcessForCompression(this,config.pathesToJs,e)}),gulp.task("typescript",function(){var e={module:"gulp-typescript",rules:[/.*.ts$/],mainPipe:getModule(M.lazyPipe)().pipe(function(){return getModule(M.ts)({noImplicitAny:!0})}),realTargetsFunction:function(e,t){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToTs,e)}),gulp.task("coffeescript",function(){var e={module:"gulp-coffee",rules:[/.*.coffee$/],mainPipe:getModule(M.lazyPipe)().pipe(function(){return getModule(M.coffee)({bare:!0})}),realTargetsFunction:function(e,t){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToCoffee,e)}),gulp.task("autominCss",function(){var e={module:"gulp-clean-css",rules:[/^.*.css$/,["!",/^.*(?:.min.css|.lisence.css|.less|.scss|.map)$/]],lisences:null,mainPipe:null};e.mainPipe=getModule(M.lazyPipe)().pipe(autoprefix).pipe(cleanCssMinification).pipe(renameSuffixMin),runTaskProcessForCompression(this,config.pathesToStyle,e)}),gulp.task("less",function(){var e={module:"gulp-less",rules:[/.*.less$/],lisences:null,mainPipe:null,realTargetsFunction:function(e,t){return[e]}};e.mainPipe=getModule(M.lazyPipe)().pipe(function(){return getModule(M.less)({paths:[getModule(M.path).join(__dirname,"less","includes")]})}).pipe(autoprefix).pipe(getModule(M.stylefmt)),runTaskProcessForPrecompiledFiles(this,config.pathesToStyleLess,e)}),gulp.task("sass",function(){var e={module:"gulp-sass",rules:[/.*.scss$/],lisences:null,mainPipe:null,realTargetsFunction:function(e,t){return getMatchingPrincipalSCSS(t.projectPath,e.hackSlashes())}};e.mainPipe=getModule(M.lazyPipe)().pipe(function(){return getModule(M.sass)({indentedSyntax:!1}).on("error",getModule(M.sass).logError)}).pipe(autoprefix).pipe(getModule(M.stylefmt)),runTaskProcessForPrecompiledFiles(this,config.pathesToSass,e)}),gulp.task("stylus",function(){var e={module:"gulp-stylus",rules:[/.*.styl$/],mainPipe:getModule(M.lazyPipe)().pipe(function(){return getModule(M.stylus)({"include css":!0,linenos:!0})}).pipe(autoprefix).pipe(getModule(M.stylefmt)),realTargetsFunction:function(e,t){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToStylus,e)}),gulp.task("writeTemp",function(){var e=new Date,t="";gulp.src(mzgFiles).pipe(getModule(M.jsValidate)())&&gulp.src(mzgFiles).pipe(getModule(M.insert).prepend(function(e){return t=/^.*[\/\\](?:gloups|gulp|dist)[\/\\](.*)/.exec(e.path)[1],/^.*log_sections.*$/.test(t)?"":"\n// -- [{0}] -- \n".format([t.hackSlashes()])})).pipe(getModule(M.concat)(gulpFileTempPath)).pipe((stayBeautiful?getModule(M.nop):getModule(M.uglify))()).pipe(gulp.dest(function(t){var s=ms2Time(new Date-e);return console.log(forNowShortLog("{0} writen after {1}",[logFilePath(gulpFileTempPath),chalk.magenta(s)])),getGulpfolderFromFileBase(t)}))}),gulp.task("writeDist",function(){var e=new Date;gulp.src(distFiles).pipe(getModule(M.jsValidate)())&&gulp.src(distFiles).pipe(getModule(M.concat)(gulpFileTempPath2)).pipe(getModule(M.replace)(/(getModule[(]M[\.][\w]+[)]+)/g,function(e){return/(M[\.][\w]+)/g.exec(e)[1]})).pipe(getModule(M.replace)(/(M[\.][\w]+)/g,function(e){return"getModule({0})".format([e])})).pipe(getModule(M.uglify)()).pipe(insertSignatureAfter("Provided","gulp- uglify, replace, concat, insert")).pipe(gulp.dest(function(t){var s=ms2Time(new Date-e);return console.log(forNowShortLog("{0} writen after {1}",[logFilePath(gulpFileTempPath2),chalk.magenta(s)])),getGulpfolderFromFileBase(t)}))}),gulp.task("rewrite",["setParams","applyTemp","applyDist"]),gulp.Gulp.prototype.__runTask=gulp.Gulp.prototype._runTask,gulp.Gulp.prototype._runTask=function(e){this.currentTask=e,this.__runTask(e)};var walkSync=function(e,t,s){var o=getModule(M.fs).readdirSync(e);return t=t||[],o.forEach(function(o){getModule(M.fs).statSync(getModule(M.path).join(e,o)).isDirectory()?t=walkSync(getModule(M.path).join(e,o),t,s):s.test(e+"/"+o)||t.push({dir:e.hackSlashes(),path:(e+"/"+o).hackSlashes(),fileName:o})}),t};function getProjectNameFromRootPath(e){var t=getConfig().projects;for(var s in t)if(e==t[s].path)return t[s].project;return e}function translateAliassesInArgs(e,t){var s,o=[];return e.forEach(function(e){(s=/^-([^\-]+)$/.exec(e))?o.push("--"+t[s[1]]):o.push(e)}),o}function getSliceOfMatchingOptions(e,t){var s=0,o=0;try{e.forEach(function(e){if(!new RegExp("^--("+t+")$","g").test(e)){if(s!=o)throw{};s++}o++})}catch(e){}return e.slice(s,o)}function metAllArgs(e){var t="";getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,SERVICES),ALL_SERVICES_OPTIONS).forEach(function(e,s){var o=new RegExp("^--(.*)$","g").exec(e)[1];0!=s&&(t+="|"),t+=o});var s=!1;for(var o in e){var n=e[o];if(!new RegExp("^("+t+")$","g").test(n)){s=!0;break}}return!s}function tasksToRunOnArgvs(){var e=[],t=[],s=0,o=getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,SERVICES),GLOUPS_OPTIONS);for(var n in o){try{n=/^[\-][\-]?([^\-]+)$/.exec(o[n])[1],new RegExp("^\\b("+PRESET_OPTIONS+")\\b$").test(n)?(checkPresetsOverdose(++s,n),e=SERVICES[n].split(" ")):e.push(n)}catch(s){if(t.push(s+" Error with option: "),/^GRAVE ERROR.*$/.test(s)){e=[];break}}s++}return logErrorsOnTaskArgvs(t),e}function checkPresetsOverdose(e,t){if(e>1)throw"GRAVE ERROR: Presets should be alone : "+t}function breath(){return"           "}function logFilePath(e){return"'{0}'".format([chalk.cyan(e)])}function logHelp(){var e,t,s=getModule(M.fs).readFileSync("help.md","utf8"),o=new classReading;o.initialize(s,0);var n=0;console.log("\n\n"),o.readLines(function(){t=o.line.replace(/\r?\n|\r/g,""),(e=/^([\s]*[#]+.*)$/.exec(t))?console.log(chalk.cyan(e[1])):(e=/^([\s]*)([$](?:[\s][^\s]+)+)([\s]{2,}.*|.*)$/.exec(t))?console.log("{0}{1}{2}".format([chalk.grey(e[1]),e[2],chalk.green(e[3])])):(e=/^([\s]*[>].*)$/.exec(t))?console.log(chalk.green(e[1])):(e=/^([\s]*)([\-]+[^\s,]+)([^\-.]*)((?:[\s][\-]+[^\s]+)+)([^\-.]*)((?:[.][^.\s]+)+|)([^\-.]*)((?:[.][^.\s]+)+|)(.*)$/.exec(t))?console.log("{0}{1}{2}{3}{4}{5}{6}{7}{8}".format([chalk.grey(e[1]),e[2],chalk.grey(e[3]),e[4],chalk.grey(e[5]),chalk.magenta(e[6]),chalk.grey(e[7]),chalk.magenta(e[8]),chalk.grey(e[9])])):(e=/^([^\-]*)((?:[\-]+[^\s]+[\s]?)+)([\s]?.*)$/.exec(t))?console.log("{0}{1}{2}".format([chalk.grey(e[1]),e[2],chalk.grey(e[3])])):t.length>0?console.log(chalk.grey(t)):++n%3==2&&console.log(t),t.length>0&&(n=0)})}function logErrorsOnTaskArgvs(e){e.length>0&&console.log("{0}\n{1}\n{2}\n{3}".format(chalk.red(e.join("\n"))),["WARNING \n\nYou may have made mistakes in shoosing wrong options.","call the folowing command to have more info of what options are valid","gulp --help"])}function logProjectErrored(e){gloupslog(" {0}  - SOMETHING IS WRONG \n".format([chalk.bgRed(" "+e.project+" ")])),gloupslog(" {0} {1}\n".format([logFilePath(e.path+"/config.mzg.json"),chalk.red(": MISMATCH")])),console.log(getColoredParagraph(" The path to that folder does not match to an actual project root folder containing a config.mzg.json file.",chalk.bgRed)+"\n\n {0}\n".format([chalk.bgWhite.black(" SOLUTION ")])+"\n"+getColoredParagraph(" ",chalk.bgWhite.grey)+getColoredParagraph(" Check the path to see if there is no mistake and fix it in the project definition.",chalk.bgWhite.grey)+"\n"+getColoredParagraph(" ",chalk.bgWhite.grey)+getColoredParagraph(" You can otherwise run the command to set up a configuration file at this path and also create nonexistent folders :",chalk.bgWhite.grey)+"\n"+getColoredParagraph(" $ gulp scanProjects",chalk.bgWhite.black)+getColoredParagraph(" ",chalk.bgWhite.grey))}function getColoredParagraph(e,t){var s=process.stdout.columns;return t(e+Array(s-e.length%s).join(" "))}function logProcessCompleteOnFile(e,t,s){try{var o=new Date;s();var n=ms2Time(new Date-o);e.length>1?(console.log(forNowShortLog("{0} of these files:\n".format([t]))),e.forEach(function(e){console.log(logFilePath(e))}),console.log(),console.log(forNowShortLog("after {0}".format([chalk.magenta(n)])))):console.log(forNowShortLog("{0} {1} after {2}".format([logFilePath(e),t,chalk.magenta(n)])))}catch(e){console.log(chalk.red(e))}}function ms2Time(e){var t,s,o;return[(o=Math.floor((s=Math.floor((t=Math.floor((e=Math.floor(e%1e3))/1e3%60))%60))%24))?o+"h ":"",s?s+"min ":"",t?t+"sec ":"",e,"ms"].join("")}function dateComputed(){var e=new Date;return[["Mon","Tues","Wednes","Thurth","Fri","Satur","Sun"][e.getDay()-1],"day,",[e.getMonth()+1,e.getDate(),e.getFullYear()].join("-")].join("")}function twodigits(e){return("0"+e).slice(-2)}function shortDateComputed(){var e=new Date;return[twodigits(e.getMonth()+1),twodigits(e.getDate()),e.getFullYear()].join("-")}function timeComputed(){var e=new Date;return[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")}function forNowLongLog(e,t){return"[{0}] {1}".format([chalk.gray(dateComputed()),e.format(t)])}function forNowShortLog(e,t){var s=e.format(t);return"[{0}] {1}".format([chalk.gray(timeComputed()),s])}function logServiceActivatedPushed(e,t,s){if(config.verbose){var o;(o=/^([^.]+)([.][^\s]*)([^.]+)([.][^\s]*)([^.]+)$/.exec(e))?console.log("{0}{1}{2}{3}{4}".format([chalk.grey(o[1]),chalk.magenta(o[2]),chalk.grey(o[3]),chalk.magenta(o[4]),chalk.grey(o[5])])):(o=/^([^.]+)([.][^\s]*)([^.]+)$/.exec(e))&&console.log("{0}{1}{2}".format([chalk.grey(o[1]),chalk.magenta(o[2]),chalk.grey(o[3])])),console.log(" Watch :'{0}{1}'\n Dest. :'{2}{3}'".format([chalk.bgCyan(" "+t+" "),chalk.cyan("/"+s.watch+" "),chalk.bgCyan(" "+t+" "),chalk.cyan("/"+s.dest+" ")]));var n=s.sourcemaps;void 0!==n&&console.log(n?"         "+chalk.bgGreen(" Sourcemaps ! "):"")}}function logTaskPurpose(e){logTaskName(e);var t={setVars:"  Sets configuration variables \n  See the mapping file to set Gloups able to serve your projects here :\n  > "+logFilePath("custom/config.mzg.ini")+":\n",automin:"  Will uglify .js files matching the folowing path(s):\n",typescript:"  Will compile .ts files matching the folowing path(s):\n",coffeescript:"  Will compile .coffee files matching the folowing path(s):\n",autominCss:"  Will compress .css files matching the folowing path(s):\n",less:"  Will process .less files matching the folowing path(s):\n",sass:"  Will process .sass files matching the folowing path(s):\n",stylus:"  Will process .styl files matching the folowing path(s):\n",scanProjects:"  Creates configuration file in every project root folder\n"};t[e]?(console.log(t[e]),logWatchList(e)):console.log(chalk.yellow("  no information provided \n"))}function logWatchList(e){var t={automin:config.pathesToJs,typescript:config.pathesToTs,coffeescript:config.pathesToCoffee,autominCss:config.pathesToStyle,less:config.pathesToStyleLess,sass:config.pathesToSass,stylus:config.pathesToStylus};t[e]&&(watchListLight(t[e]).forEach(function(e,t){console.log("    '{0}{1}'".format([chalk.bgCyan(" "+e.project),chalk.cyan(e.watch+" ")]))}),console.log())}function logTaskName(e){console.log("\n {0}{1}\n".format([chalk.bgWhite.black(" T:"),chalk.bgWhite.black(e+" ")]))}function logTaskEndUgly(e){console.log("      > which is uglyfied "+chalk.red("for performances")),e?console.log("  once: "+chalk.red("not watching specific files")+"\n"):console.log()}function logTaskEndBeauty(e){console.log("      > which is beautifull "+chalk.red("for debugging")+"\n"),e?console.log("  once: "+chalk.red("not watching specific files")+"\n"):console.log()}
/* -- Provided with Gloups 6.1.3 | using gulp- uglify, replace, concat, insert -- */