/*jshint esversion: 6 */
/*jshint ignore:start */
var pjson=require("./package.json"),GLOUPS_VERSION=pjson.version;process.title="Gloups "+GLOUPS_VERSION+" | Chears !";var glob_timer,gulp=require("gulp"),chalk=require("chalk"),M={autoprefixer:"gulp-autoprefixer",cleanCSS:"gulp-clean-css",clear:"clear",coffee:"gulp-coffee",concat:"gulp-concat",del:"del",exit:"gulp-exit",gfile:"gulp-file",fs:"fs",fssync:"fs-sync",insert:"gulp-insert",jsValidate:"gulp-jsvalidate",lazyPipe:"lazypipe",less:"gulp-less",nop:"gulp-nop",path:"path",progress:"progress",rename:"gulp-rename",replace:"gulp-replace",sass:"gulp-sass",sourcemaps:"gulp-sourcemaps",stylefmt:"gulp-stylefmt",stylus:"gulp-stylus",through:"through2",ts:"gulp-typescript",uglify:"gulp-uglifyes",wait:"gulp-wait"},SERVICES={t:"typescript",c:"coffeescript",s1:"less",s2:"sass",s3:"stylus",minj:"automin",minc:"autominCss",tr:"transitive",es:"essential",a:"all",all:"automin typescript coffeescript autominCss less sass stylus",styles:"autominCss less sass stylus",js:"automin typescript coffeescript",cof:"automin coffeescript",tps:"automin typescript"},PRESET_OPTIONS="all|styles|cof|tps|js",SERVICES_OPTIONS="automin|autominCss|typescript|coffeescript|less|sass|stylus",SERVICES_ADVANCED_OPTIONS="transitive|essential",ALL_SERVICES_OPTIONS=PRESET_OPTIONS+"|"+SERVICES_OPTIONS+"|"+SERVICES_ADVANCED_OPTIONS,JS_REGEX_FILE_PATH_PATTERN="^(?:((?:[^\\.]+|..)[\\x2F\\x5C])|)((?:([^\\.^\\x2F^\\x5C]+)(?:((?:[.](?!\\bmin\\b)(?:[^\\.]+))+|))(?:([.]min)([.]js)|([.]js))))$",FILE_COVERAGE_REGEXP=/^(.*)[\\\/]\*\*[\\\/]\*\..*$/,FILE_STARTING_BY_UNDERSCORE=/^.*[\/\\](_.*)$/i,GLOUPS_OPTIONS=SERVICES_OPTIONS+"|"+PRESET_OPTIONS,SILENT_TASKS="watch|vet|unit-test|integration-test",ISALL=!0,AUTOPREFIXER_BROWSERS=["> 1%","last 2 versions","firefox >= 4","safari 7","safari 8","IE 8","IE 9","IE 10","IE 11"],DEFAULT_CONFIG={verbose:!1,pathesToJs:[],pathesToTs:[],pathesToCoffee:[],pathesToStyle:[],pathesToStyleLess:[],pathesToSass:[],pathesToStylus:[],projects:[]},isdist={},config=getConfig(),glob_found_modules={fs:!0},glob_visited_elements={infunc:{},intask:{}},glob_logging_obj={},glob_mayLogEssentials=metAllArgs(["essential"]);class classReading{constructor(){this.line_=null,this.data_=null,this.iter_=null,this.stopped_=!1}initialize(e,t){this.data_=e+" ",this.iter_=t,this.line_=[]}readLines(e){for(var t;!this.stopped&&(t=this.getNextChar());)/^[\n\r]$/g.test(t)||this.isEndReached()?(this.toLine(),e(this.line),this.resetLine()):this.feed(t)}stop(){this.stopped=!0}get stopped(){return this.stopped_}set stopped(e){this.stopped_=e}get iter(){return this.iter_}set iter(e){this.iter_=e}get data(){return this.data_}set data(e){this.data_=e}get line(){return this.line_}set line(e){this.line_=e}toLine(){this.line=this.line.join(""),this.line=this.line.replace(/^[\n\r]$/g,"")}resetLine(){this.line=[]}getNextChar(){return this.data[this.iter++]}isEndReached(){return!this.data[this.iter]}feed(e){this.line_.push(e)}}String.prototype.format=function(e){return this.replace(String.prototype.format.regex,function(t){var s=parseInt(t.substring(1,t.length-1));return s>=0?e[s]:-1===s?"{":-2===s?"}":""})},String.prototype.format.regex=new RegExp("{-?[0-9]+}","g"),String.prototype.hackSlashes=function(){return this.replace(/[\\]/g,"/")};var cmd=String(process.argv[2]);if(ISALL||new RegExp("^(({0})(:.*)?)$".format([SILENT_TASKS])).test(cmd)){var isWatching=/^(watch:.*)$/.test(cmd),firstCall=!1,on=gulp.on;gulp.on=function(e,t){if(!/^(task_start|task_stop)$/.test(e)||!/gutil\.log\(\s*'(Starting|Finished)/.test(t.toString()))return on.apply(gulp,arguments)},gulp.on("start",function(){firstCall&&(isWatching&&process.stdout.write(""),firstCall=!1)}),gulp.on("stop",function(){firstCall=!0})}function getModule(e){if("string"==typeof e)for(var t in M)if(M[t]==e){var s=new Date;M[t]=require(e);var o=ms2Time(new Date-s);return isdist.NOT_DISTRIBUTION&&console.log(forNowShortLog(" {0}{1} loaded after {2}".format([chalk.bgMagenta(" M:"),chalk.bgMagenta(e+" "),chalk.magenta(o)]))),M[t]}return e}var logOrig=console.log;function gloupslog(e){var t=/^([\s](?:(?:[^\s]+[\s]?)+)[\s]+)(['].*['])$/.exec(e);isPulseTask()&&t?gloupsHandlingPulseLogging({action:t[1],path:t[2]}):logOrig(e)}function coverFoldersToServe(e){for(var t in config.projects){var s=config.projects[t];"*"!=e.scope&&s.project!=e.scope||(getModule(M.fssync).exists(s.path+"\\config.mzg.json")?(e.shouldLog&&console.log(" "+chalk.bgGreen(" "+s.project+" ")),s.checked&&setUpProjectWatchingPaths(s.path,e.shouldLog)):e.shouldLog&&logProjectErrored(s))}}function fireEnventOnEveryCoveredFiles(e){e.sort(function(e,t){return e.localeCompare(t)}).forEach(function(e,t){gulp.src(e).pipe(gulp.dest(function(e){return e.base}))})}function getEveryFilesCoveredOnce(e){var t={};return e.forEach(function(e,s){getModule(M.fssync).exists(e)&&walkSync(e,[],FILE_STARTING_BY_UNDERSCORE).forEach(function(e,s){t[e.path]=!0})}),Object.keys(t)}function getAllServiceCoverageWatchFolders(){var e=[];return[].concat(config.pathesToJs,config.pathesToTs,config.pathesToCoffee,config.pathesToStylus,config.pathesToSass,config.pathesToStyle,config.pathesToStyleLess).forEach(function(t,s){e.push(FILE_COVERAGE_REGEXP.exec(t.watch)[1])}),e}function runTaskProcessForCompression(e,t,s){var o=createMainLazyPipeObject(t,"Compressed    ",s.module),n=watchList(t);gulp.watch(n,function(e){var n=e.path;if(checkMultipleRules(n,["deleted"!==e.type].concat(s.rules))){o.forMatchingObj.path=n;var i=getMatchingEntryConfig(n,t);o.pathesDescr=i,o.process=s.mainPipe,o.source_kind="simple",consumePipeProcss(null,o,[n])}})}function runTaskProcessForPrecompiledFiles(e,t,s){var o=createMainLazyPipeObject(t,"Processed     ",s.module),n=watchList(t),i=getFreshTransitivity();gulp.watch(n,function(e){var n=e.path;if(checkMultipleRules(n,s.rules)){o.forMatchingObj.path=n;var a=getMatchingEntryConfig(n,t);o.process=s.mainPipe;var r=s.realTargetsFunction(n,a);o.source_kind="complex",consumePipeProcss(i,o,r)}})}function consumePipeProcss(e,t,s){var o=transitiveAndSourcemappingWrap(e,t);t.destCallBack=function(s){return s&&(isPulseTask()||gloupslog(""),logLongWaiting(t)),null!=e?e.dest:t.pathesDescr.dest},gulp.src(s).pipe(o()).on("end",function(){logChangedRealTargetedFiles(t,s),exitOnPulseAfterCount(),exitCountForLongLog()}).pipe(applyLicenceSplitting(t)).pipe(gulp.dest(t.destCallBack(!0)))}function exitCountForLongLog(){isPulseTask()||clearInterval(glob_timer)}function exitOnPulseAfterCount(){isPulseTask()&&resetTimer({total:100,format:":bar pulse closing in (:countdown)"},function(){gulp.start("clear"),gloupslogSumerise(),process.exit()},100)}function isPulseTask(){return"pulse"==process.argv[2]}function logLongWaiting(e){"complex"==e.source_kind&&resetTimer({total:2},function(){console.log(" "+chalk.bgYellow(" ! ")+" Long process ... few secondes required")})}function resetTimer(e,t,s){var o=e.format?e.format:"";/.*:countdown.*/.test(o)&&e.total++;var n=new(getModule(M.progress))(o,{total:e.total,width:80,complete:String.fromCharCode(9608),incomplete:chalk.grey(".")});glob_timer&&clearInterval(glob_timer),glob_timer=setInterval(function(){/.*:countdown.*/.test(o)?n.tick({countdown:e.total-n.curr-1}):n.tick(),n.complete&&(t(),clearInterval(glob_timer))},s||500)}function transitiveAndSourcemappingWrap(e,t){var s=t.forMatchingObj,o=s.path,n=s.pathesDescr,i=t.message,a=getMatchingEntryConfig(o,n);return setSourceMappingAndSign(transitiveWrapAround(e,a,o,t),a,i)}function setSourceMappingAndSign(e,t,s){var o=t.sourcemaps;return getModule(M.lazyPipe)().pipe(o?getModule(M.sourcemaps).init:getModule(M.nop)).pipe(e).pipe(insertSignatureAfter,s.action,s.module).pipe(o?function(){return getModule(M.sourcemaps).write("./")}:getModule(M.nop))}function transitiveWrapAround(e,t,s,o){return null!=e&&"draft"==e.dest&&transitivitySetupCore(e,t,s),applyLazyPipeSet({opening:null!=e?getModule(M.lazyPipe)().pipe(transitivitySetup,e,t,s):getModule(M.nop),closing:null!=e?getModule(M.lazyPipe)().pipe(e.suffixing).pipe(e.compressing):getModule(M.nop),main:o})}function applyLazyPipeSet(e){var t=e.main.process,s=e.main.source_kind;return"simple"==s?getModule(M.lazyPipe)().pipe(e.opening).pipe(lisencesSetup(t)).pipe(separateLisences(t)).pipe(t).pipe(separatePreemptedLisences(t)).pipe(e.closing):"complex"==s?getModule(M.lazyPipe)().pipe(e.opening).pipe(lisencesSetup(t)).pipe(t).pipe(separateLisences(t)).pipe(e.closing):void 0}function transitivitySetup(e,t,s){return getModule(M.through).obj(function(o,n,i){transitivitySetupCore(e,t,s),i(null,o)})}function shouldBeTransitive(){return metAllArgs(["all","transitive"])||metAllArgs(["sass","autominCss","transitive"])||metAllArgs(["stylus","autominCss","transitive"])||metAllArgs(["less","autominCss","transitive"])||metAllArgs(["coffeescript","automin","transitive"])||metAllArgs(["typescript","automin","transitive"])}function transitivitySetupCore(e,t,s){var o=!1;if(e.dest=t.dest,shouldBeTransitive()){var n=/^.*[\/](.*)$/g.exec(s.hackSlashes())[1],i="{0}/{1}".format([t.dest,n]),a=/.*[.](coffee|ts)$/.test(n)?"JS":/.*[.](scss|styl|less)$/.test(n)?"CSS":"UNDEFINED",r=getMatchingEntryConfig(i,"JS"==a?config.pathesToJs:"CSS"==a?config.pathesToStyle:null);o=null!=r,e.should=o,o&&(e.compressing="JS"==a?getModule(M.uglify):"CSS"==a?cleanCssMinification:getModule(M.nop),e.suffixing=renameSuffixMin,e.dest=r.dest)}}function renameSuffixMin(){return getModule(M.rename)(function(e){e.extname=".min"+e.extname})}function renameCustomSuffix(e){return getModule(M.rename)(function(t){t.extname=e+t.extname})}function cleanCssMinification(){return getModule(M.cleanCSS)({compatibility:"ie8"})}function insertSignatureAfter(e,t){return getModule(M.insert).append("\n/* -- {0} wth Gloups v {1} - {2} | thanks to {3} -- */".format([e.replace(/[\s]+$/,""),GLOUPS_VERSION,shortDateComputed(),t]))}function autoprefix(){return getModule(M.autoprefixer)({browsers:AUTOPREFIXER_BROWSERS,cascade:!1})}function logChangedRealTargetedFiles(e,t){var s,o=e.forMatchingObj.pathesDescr,n=e.message.action,i=0;if(t.length>1)t.forEach(function(e){i++>0&&(n="              "),s=getProjectNameWithFileFromPathDesc(o,e),gloupslog(" {0} '{1}{2}'".format([n,chalk.bgCyan(" "+s.projectName+" "),chalk.cyan(s.fileName+" ")]))});else{var a=t[0].hackSlashes();s=getProjectNameWithFileFromPathDesc(o,a),gloupslog(" {0} '{1}{2}'".format([n,chalk.bgCyan(" "+s.projectName+" "),chalk.cyan(s.fileName+" ")]))}}function getProjectNameWithFileFromPathDesc(e,t){var s=/[^\/\\]*(\/.*)/.exec(t)[1];s=".."+s;var o,n="<PROJECT NM>";for(var i in e){var a,r=e[i].projectPath.split("/").join("\\/")+"(.*)$";if(a=new RegExp(r,"g").exec(s)){n=e[i].projectName,o=a[1];break}}return{projectName:n,fileName:o}}function separateLisences(e){return getModule(M.lazyPipe)().pipe(function(){return getModule(M.through).obj(function(t,s,o){var n="simple"==e.lisences.source_kind?getModule(M.fs).readFileSync(t.path,"utf8"):"complex"==e.lisences.source_kind?t._contents.toString():"";if("complex"==e.lisences.source_kind){var i=distributeLisencesOutOfChunk(e,n);shouldBeTransitive()&&(t._contents=Buffer.from(i,"utf8"))}else"simple"==e.lisences.source_kind&&(t._contents=Buffer.from(distributeLisencesOutOfChunk(e,n),"utf8"),e.preemptedData=Buffer.from(e.lisences.data,"utf8"));o(null,t)})})}function separatePreemptedLisences(e){return getModule(M.lazyPipe)().pipe(function(){return getModule(M.through).obj(function(t,s,o){var n=e.preemptedData.toString();distributeLisencesOutOfChunk(e,n),o(null,t)})})}function lisencesSetup(e){return e.lisences={data:"",source_kind:""},getModule(M.lazyPipe)().pipe(function(){return getModule(M.through).obj(function(t,s,o){e.lisences.source_kind=/.*[.](?:scss|styl|less|ts|coffee)$/.test(t.path)?"complex":/.*[.](?:css|js)$/.test(t.path)?"simple":"unknown",o(null,t)})})}function aLazyPipeThatIsPipingLikeNop(){return getModule(M.lazyPipe)().pipe(getModule(M.nop))}function distributeLisencesOutOfChunk(e,t){var s=readLisences(t);return e.lisences.data=s.lisences,s.not_lisences}function readLisences(e){var t=new classReading;t.initialize(e,0);var s={reading:t,line:"",cpt:0,result:[],anti_result:[],canprint:!1,inLisence:!1,line_count:.5};return t.readLines(function(){readingLisencesProcess(s)}),{lisences:s.result.join("\n"),not_lisences:s.anti_result.join("\n")}}function readingLisencesProcess(e){e.line=e.reading.line,e.canprint=!1,/^.*(?:\/\*!).*(?:\*\/).*$/.test(e.line)?e.canprint=!0:/^.*(?:\/\*!).*$/.test(e.line)?(e.canprint=!0,e.inLisence=!0):e.inLisence&&/^.*(?:\*\/).*$/.test(e.line)&&(e.canprint=!0,e.inLisence=!1),inLisenceProcess(e)}function inLisenceProcess(e){e.inLisence&&((e.line.length>0||++e.cpt%3==2)&&(e.canprint=!0),e.line.length>0&&(e.cpt=0)),e.canprint?e.result.push(e.line):e.anti_result.push(e.line),e.line_count+=.5,Number.isInteger(e.line_count)}function applyLicenceSplitting(e){return getModule(M.through).obj(function(t,s,o){var n=e.process.lisences;if(n&&""!=n.data){var i=/^.*[\/\\]([^\.]+.*)min.(css|js)$/.exec(t.path.hackSlashes());if(i&&/^.*[.]min[.].*$/.test(t.path.hackSlashes())){var a=e.destCallBack(!1)+"/"+i[1]+"lisence."+i[2];getModule(M.fssync).write(a,"{0} \n/* -- {1} with Gloups v {2} - {3} | thanks to {4} -- */".format([n.data,"Lisence(s) exported",GLOUPS_VERSION,shortDateComputed(),"gulp-through2 ; gulp-fssync"]),"utf8");var r=getProjectNameWithFileFromPathDesc(e.forMatchingObj.pathesDescr,a.hackSlashes());gloupslog(" {0} '{1}{2}'".format(["Lis. reported ",chalk.bgCyan(" "+r.projectName+" "),chalk.cyan(r.fileName+" ")]))}}o(null,t)})}function contains(e,t){for(var s=e.length;s--;)if(e[s]===t)return!0;return!1}function getMatchingPrincipalSCSS(e,t){var s=/^.*[\/\\](.*)$/.exec(t);if(s&&s[1]&&/^_.*$/.test(s[1])){var o=(s=/^(.*[\\\/])_?(.*)[.].*$/g.exec(t))[1]+s[2],n=e.length,i=pathEllipzizeing(o,0,t.substr(n).split("/").length),a=[],r=config.sassMaching;for(var l in r)contains(r[l].partials,i)&&a.push(r[l].target);return a}return[t]}function getFreshTransitivity(){return{should:!1,dest:"draft",compressing:getModule(M.nop),suffixing:getModule(M.nop)}}function createMainLazyPipeObject(e,t,s){return{process:null,destCallBack:function(){return gulp.dest("draft")},forMatchingObj:{path:null,pathesDescr:e},message:{action:t,module:s,files:[]}}}function checkMultipleRules(e,t,s){var o=t[s=void 0!=s?s:0],n=!0;if(void 0!=o)if("boolean"==typeof o)n=n&&!!o&&checkMultipleRules(e,t,++s);else if("object"==typeof o)if(o instanceof Array)"string"==typeof o[1]&&(o[1]=new RegExp(o[1],"g")),n="!"==o[0]&&!o[1].test(e);else{if(!(o instanceof RegExp))return gloupslog(chalk.red("undefined case ...")),!1;n=n&&!!n&&checkMultipleRules(e,t,++s)}else{if("string"!=typeof o)return gloupslog(chalk.red("undefined case ...")),!1;n=(n=new RegExp(o,"g").test(e))&&!!n&&checkMultipleRules(e,t,++s)}return n}function getConfig(){return config||DEFAULT_CONFIG}function readJsonConfig(e){var t,s,o=getModule(M.fs).readFileSync(e,"utf8"),n=new classReading;n.initialize(o,0);var i=0,a=!0,r="",l=(t=/^(.*)(\.json)$/.exec(e))[1]+".temp"+t[2],c=t[1]+"2.temp"+t[2];getModule(M.fssync).write(l,"","utf8"),n.readLines(function(){s=n.line,(a=t=/^(.*)\/\/.*$/g.exec(s))?r=t[1]:(a=t=/^(.*)\/\*$/g.exec(s))?(r=t[1],++i):(a=t=/^.*\*\/(.*)$/g.exec(s))?(r=t[1],--i):(a=0==i)&&(r=s),a&&(/^[\s]*$/g.test(r)||(getModule(M.fs).appendFileSync(c,r+"\r\n","utf8"),getModule(M.fs).appendFileSync(l,/^[\s\t]*((?:[^\s\t]*[\s\t]*[^\s\t])+)[\s\t]*$/.exec(r)[1],"utf8")))});var g=getModule(M.fs).readFileSync(l,"utf8");return getModule(M.fssync).remove(l),getModule(M.fssync).remove(c),JSON.parse(g.replace(/}(,)]/g,"}]"))}function setConfig(){config.projects=readJsonConfig("custom/config.json").projects}function makePathesCoveringAllFilesFor(e,t,s,o){var n=t.addon,i=t.pathesToService;if(t.projectPath=e,n){for(var a=0,r=n.length;a<r;++a){n[a].watch=n[a].watch+s;n[a].watch,n[a].dest;0<a&&(o="[SAME-PURPOSE]");var l=getProjectNameFromRootPath(e);logServiceActivatedPushed(o,l,n[a]),n[a].watch=e+"/"+n[a].watch,n[a].dest=e+"/"+n[a].dest,n[a].projectPath=e,n[a].projectName=l,i=i.concat(n[a])}config.verbose&&console.log()}return i}function coverFoldersToServe(e){for(var t in config.projects){var s=config.projects[t];"*"!=e.scope&&s.project!=e.scope||(getModule(M.fssync).exists(s.path+"\\config.mzg.json")?s.checked&&(e.shouldLog&&!isPulseTask()&&console.log(" "+chalk.bgGreen(" "+s.project+" ")),setUpProjectWatchingPaths(s.path,e.shouldLog)):e.shouldLog&&!isPulseTask()&&logProjectErrored(s))}}function fireEnventOnEveryCoveredFiles(e){e.sort(function(e,t){return e.localeCompare(t)}).forEach(function(e,t){gulp.src(e).pipe(gulp.dest(function(e){return e.base}))})}function getEveryFilesCoveredOnce(e){var t={};return e.forEach(function(e,s){getModule(M.fssync).exists(e)&&walkSync(e,[],FILE_STARTING_BY_UNDERSCORE).forEach(function(e,s){t[e.path]=!0})}),Object.keys(t)}function getAllServiceCoverageWatchFolders(){var e=[];return[].concat(config.pathesToJs,config.pathesToTs,config.pathesToCoffee,config.pathesToStylus,config.pathesToSass,config.pathesToStyle,config.pathesToStyleLess).forEach(function(t,s){e.push(FILE_COVERAGE_REGEXP.exec(t.watch)[1])}),e}function setUpProjectWatchingPaths(e,t){var s=readJsonConfig(e+"/config.mzg.json");t&&!isPulseTask()&&(console.log("Activated Services for target project under the path [FOLDER]:"),console.log(logFilePath(e)+"\n")),config.pathesToJs=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToJs,addon:s.minify_js},"/**/*.js","Compress .js files into .min.js files"),config.pathesToTs=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToTs,addon:s.ts_to_js},"/**/*.ts","Compile .ts files into .js file"),config.pathesToCoffee=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToCoffee,addon:s.coffee_to_js},"/**/*.coffee","Compile .coffee files into .js file"),config.pathesToStyle=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStyle,addon:s.minify_css},"/**/*.css","Compress .css files"),config.pathesToStyleLess=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStyleLess,addon:s.less},"/**/*.less","Compile .less files into .css files"),config.pathesToSass=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToSass,addon:s.sass},"/**/*.scss","Compile .scss files into .css files"),config.pathesToStylus=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStylus,addon:s.stylus},"/**/*.styl","Compile .styl files into .css files")}function getMatchingEntryConfig(e,t){for(var s in e=e.hackSlashes(),t){var o=t[s],n=o.watch.hackSlashes(),i=(o.dest.hackSlashes(),new RegExp("^([^\\\\/*]+).([^\\*]+)([\\/]?[\\/*]+[\\/]?)(.*)$","g").exec(n)[2]);if(new RegExp("^.*(?:"+i+").*$","g").exec(e))return o}return null}function watchList(e){var t=[];for(var s in e){var o=e[s].watch;t.push(o)}return t}function watchListLight(e){var t=[];return e.forEach(function(e){var s=e.watch,o=e.projectPath.length,n=s.substr(o);t.push({project:e.projectName,watch:n})}),t}function mappSassMatching(e,t){var s;if((s=/^(.*)[\\\/]\*\*[\\\/]\*\..*$/.exec(t))&&s[1]){config.sassMaching=[];var o=0;walkSync(s[1],[],new RegExp("^.*[\\/](_.*)$","i")).forEach(function(t){config.sassMaching.push({identifier:t.fileName,target:t.path,partials:[]}),pushEllipsizedPartials(e,t,o++)})}}function pushEllipsizedPartials(e,t,s){var o=new classReading,n=getModule(M.fs).readFileSync(t.path,"utf8");o.initialize(n,0);var i,a,r=e.length;o.readLines(function(){if(i=o.line,(a=/^@import[\s].*["](.*)["]/.exec(i))&&a[1]){var e="{0}/{1}".format([t.dir,a[1]]),n=pathEllipzizeing(e,0,e.substr(r).split("/").length);config.sassMaching[s].partials.push(n)}})}function pathEllipzizeing(e,t,s){var o="^(?:(?:((?:[^/\\]+[\\/]{-1}1,2{-2}){-1}{0}{-2}).*((?:[\\/][^/\\?]+){-1}{1},{-2}[\\/]?)[^?]*).*|([^?]*).*)$".format([t,s]),n=new RegExp(o,"g").exec(e);return n[3]?n[3]:n[1]+"..."+n[2]}function walkSync(e,t,s){var o=getModule(M.fs).readdirSync(e),n=getModule(M.path);return t=t||[],o.forEach(function(o){getModule(M.fs).statSync(n.join(e,o)).isDirectory()?t=walkSync(n.join(e,o),t,s):s.test(e+"/"+o)||t.push({dir:e.hackSlashes(),path:(e+"/"+o).hackSlashes(),fileName:o})}),t}function getProjectNameFromRootPath(e){var t=getConfig().projects;for(var s in t)if(e==t[s].path)return t[s].project;return e}function translateAliassesInArgs(e,t){var s,o=[];return e.forEach(function(e){(s=/^-([^\-]+)$/.exec(e))?o.push("--"+t[s[1]]):o.push(e)}),o}function getSliceOfMatchingOptions(e,t){var s=0,o=0;try{e.forEach(function(e){if(!new RegExp("^--("+t+")$","g").test(e)){if(s!=o)throw{};s++}o++})}catch(e){}return e.slice(s,o)}function metAllArgs(e){var t="";getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,SERVICES),ALL_SERVICES_OPTIONS).forEach(function(e,s){var o=new RegExp("^--(.*)$","g").exec(e)[1];0!=s&&(t+="|"),t+=o});var s=!1;for(var o in e){var n=e[o];if(!new RegExp("^("+t+")$","g").test(n)){s=!0;break}}return!s}function tasksToRunOnArgvs(){var e=[],t=[],s=0,o=getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,SERVICES),GLOUPS_OPTIONS);for(var n in o){try{n=/^[\-][\-]?([^\-]+)$/.exec(o[n])[1],new RegExp("^\\b("+PRESET_OPTIONS+")\\b$").test(n)?(checkPresetsOverdose(++s,n),e=SERVICES[n].split(" ")):e.push(n)}catch(s){if(t.push(s+" Error with option: "),/^GRAVE ERROR.*$/.test(s)){e=[];break}}s++}return logErrorsOnTaskArgvs(t),e}function checkPresetsOverdose(e,t){if(e>1)throw"GRAVE ERROR: Presets should be alone : "+t}function breath(){return"           "}function logFilePath(e){return"'{0}'".format([chalk.cyan(e)])}function logHelp(){var e,t,s=getModule(M.fs).readFileSync("help.md","utf8"),o=new classReading;o.initialize(s,0);var n=0;console.log("\n\n"),o.readLines(function(){t=o.line.replace(/\r?\n|\r/g,""),(e=/^([\s]*[#]+.*)$/.exec(t))?console.log(chalk.cyan(e[1])):(e=/^([\s]*)([$](?:[\s][^\s]+)+)([\s]{2,}.*|.*)$/.exec(t))?console.log("{0}{1}{2}".format([chalk.grey(e[1]),e[2],chalk.green(e[3])])):(e=/^([\s]*[>].*)$/.exec(t))?console.log(chalk.green(e[1])):(e=/^([\s]*)([\-]+[^\s,]+)([^\-.]*)((?:[\s][\-]+[^\s]+)+)([^\-.]*)((?:[.][^.\s]+)+|)([^\-.]*)((?:[.][^.\s]+)+|)(.*)$/.exec(t))?console.log("{0}{1}{2}{3}{4}{5}{6}{7}{8}".format([chalk.grey(e[1]),e[2],chalk.grey(e[3]),e[4],chalk.grey(e[5]),chalk.magenta(e[6]),chalk.grey(e[7]),chalk.magenta(e[8]),chalk.grey(e[9])])):(e=/^([^\-]*)((?:[\-]+[^\s]+[\s]?)+)([\s]?.*)$/.exec(t))?console.log("{0}{1}{2}".format([chalk.grey(e[1]),e[2],chalk.grey(e[3])])):t.length>0?console.log(chalk.grey(t)):++n%3==2&&console.log(t),t.length>0&&(n=0)})}function logErrorsOnTaskArgvs(e){e.length>0&&console.log("{0}\n{1}\n{2}\n{3}".format(chalk.red(e.join("\n"))),["WARNING \n\nYou may have made mistakes in shoosing wrong options.","call the folowing command to have more info of what options are valid","gulp --help"])}function logProjectErrored(e){gloupslog(" {0}  - SOMETHING IS WRONG \n".format([chalk.bgRed(" "+e.project+" ")])),gloupslog(" {0} {1}\n".format([logFilePath(e.path+"/config.mzg.json"),chalk.red(": MISMATCH")])),console.log(getColoredParagraph(" The path to that folder does not match to an actual project root folder containing a config.mzg.json file.",chalk.bgRed)+"\n\n {0}\n".format([chalk.bgWhite.black(" SOLUTION ")])+"\n"+getColoredParagraph(" ",chalk.bgWhite.grey)+getColoredParagraph(" Check the path to see if there is no mistake and fix it in the project definition.",chalk.bgWhite.grey)+"\n"+getColoredParagraph(" ",chalk.bgWhite.grey)+getColoredParagraph(" You can otherwise run the command to set up a configuration file at this path and also create nonexistent folders :",chalk.bgWhite.grey)+"\n"+getColoredParagraph(" $ gulp scanProjects",chalk.bgWhite.black)+getColoredParagraph(" ",chalk.bgWhite.grey))}function getColoredParagraph(e,t){var s=process.stdout.columns;return t(e+Array(s-e.length%s).join(" "))}function logProcessCompleteOnFile(e,t,s){try{var o=new Date;s();var n=ms2Time(new Date-o);e.length>1?(console.log(forNowShortLog("{0} of these files:\n".format([t]))),e.forEach(function(e){console.log(logFilePath(e))}),console.log(),console.log(forNowShortLog("after {0}".format([chalk.magenta(n)])))):console.log(forNowShortLog("{0} {1} after {2}".format([logFilePath(e),t,chalk.magenta(n)])))}catch(e){console.log(chalk.red(e))}}function ms2Time(e){var t,s,o;return[(o=Math.floor((s=Math.floor((t=Math.floor((e=Math.floor(e%1e3))/1e3%60))%60))%24))?o+"h ":"",s?s+"min ":"",t?t+"sec ":"",e,"ms"].join("")}function dateComputed(){var e=new Date;return[["Mon","Tues","Wednes","Thurth","Fri","Satur","Sun"][e.getDay()-1],"day,",[e.getMonth()+1,e.getDate(),e.getFullYear()].join("-")].join("")}function twodigits(e){return("0"+e).slice(-2)}function shortDateComputed(){var e=new Date;return[twodigits(e.getMonth()+1),twodigits(e.getDate()),e.getFullYear()].join("-")}function timeComputed(){var e=new Date;return[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")}function forNowLongLog(e,t){return"[{0}] {1}".format([chalk.gray(dateComputed()),e.format(t)])}function forNowShortLog(e,t){var s=e.format(t);return"[{0}] {1}".format([chalk.gray(timeComputed()),s])}function logServiceActivatedPushed(e,t,s){if(config.verbose){var o;(o=/^([^.]+)([.][^\s]*)([^.]+)([.][^\s]*)([^.]+)$/.exec(e))?console.log("{0}{1}{2}{3}{4}".format([chalk.grey(o[1]),chalk.magenta(o[2]),chalk.grey(o[3]),chalk.magenta(o[4]),chalk.grey(o[5])])):(o=/^([^.]+)([.][^\s]*)([^.]+)$/.exec(e))&&console.log("{0}{1}{2}".format([chalk.grey(o[1]),chalk.magenta(o[2]),chalk.grey(o[3])])),console.log(" Watch :'{0}{1}'\n Dest. :'{2}{3}'".format([chalk.bgCyan(" "+t+" "),chalk.cyan("/"+s.watch+" "),chalk.bgCyan(" "+t+" "),chalk.cyan("/"+s.dest+" ")]));var n=s.sourcemaps;void 0!==n&&console.log(n?"         "+chalk.bgGreen(" Sourcemaps ! "):"")}}function logTaskPurpose(e){logTaskName(e);var t={setVars:"  Sets configuration variables \n  See the mapping file to set Gloups able to serve your projects here :\n  > "+logFilePath("custom/config.mzg.ini")+":\n",automin:"  Will uglify .js files matching the folowing path(s):\n",typescript:"  Will compile .ts files matching the folowing path(s):\n",coffeescript:"  Will compile .coffee files matching the folowing path(s):\n",autominCss:"  Will compress .css files matching the folowing path(s):\n",less:"  Will process .less files matching the folowing path(s):\n",sass:"  Will process .sass files matching the folowing path(s):\n",stylus:"  Will process .styl files matching the folowing path(s):\n",scanProjects:"  Creates configuration file in every project root folder\n"};t[e]?(console.log(t[e]),logWatchList(e)):console.log(chalk.yellow("  no information provided \n"))}function logWatchList(e){var t={automin:config.pathesToJs,typescript:config.pathesToTs,coffeescript:config.pathesToCoffee,autominCss:config.pathesToStyle,less:config.pathesToStyleLess,sass:config.pathesToSass,stylus:config.pathesToStylus};t[e]&&(watchListLight(t[e]).forEach(function(e,t){console.log("    '{0}{1}'".format([chalk.bgCyan(" "+e.project),chalk.cyan(e.watch+" ")]))}),console.log())}function logTaskName(e){console.log("\n {0}{1}\n".format([chalk.bgWhite.black(" T:"),chalk.bgWhite.black(e+" ")]))}function logTaskEndUgly(e){console.log("      > which is uglyfied "+chalk.red("for performances")),e?console.log("  once: "+chalk.red("not watching specific files")+"\n"):console.log()}function logTaskEndBeauty(e){console.log("      > which is beautifull "+chalk.red("for debugging")+"\n"),e?console.log("  once: "+chalk.red("not watching specific files")+"\n"):console.log()}function gloupsHandlingPulseLogging(e){var t=e.action.replace(/^[\s]+/,"").replace(/[\s]+$/,""),s=e.path;glob_logging_obj[t]||(glob_logging_obj[t]={}),glob_logging_obj[t][s.replace(/'/,"")]||(glob_logging_obj[t][s.replace(/'/,"")]=!0)}function gloupslogSumerise(){Object.keys(glob_logging_obj).forEach(function(e,t){t>0&&logOrig("\n");var s=Object.keys(glob_logging_obj[e]);logOrig(" Files labeled {0} ({1})\n".format([chalk.bgRed(" "+e+" "),s.length])),s.sort(function(e,t){return e.localeCompare(t)}).forEach(function(e,t){logOrig(" "+e)})})}glob_mayLogEssentials&&(console.log=function(){},gloupslog(forNowShortLog(chalk.bgRed(" Logging only essential messages ")))),gulp.task("default",["setParams"]),gulp.task("clear",function(){process.stdout.write("c")}),gulp.task("setVars",function(){for(var e in setConfig(),isdist.NOT_DISTRIBUTION&&getModule(M.path),config.verbose||isPulseTask()||logTaskPurpose(this.currentTask.name),coverFoldersToServe({scope:"*",shouldLog:!0}),config.pathesToSass){var t=config.pathesToSass[e].watch;mappSassMatching(config.pathesToSass[e].projectPath,t)}isdist.NOT_DISTRIBUTION&&!isPulseTask()&&(config.verbose||console.log(forNowLongLog("{0}\n",["config externalized under config.json"])),gulp.start("externalizeConfig")),config.verbose||isPulseTask()||console.log(forNowLongLog("{0}\n",["CONFIGURATON PROCEEDED"]))}),gulp.task("setParams",function(){var e,t=this.seq.slice(-1)[0];if(/^default$/.test(t))e=tasksToRunOnArgvs(),gulp.start(e.length>0?["setVars"].concat(e):[]);else if(/^serve$/.test(t))process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Serve"]),e=tasksToRunOnArgvs(),isdist.NOT_DISTRIBUTION&&getAllNeededModules(e.concat(["setVars"])),gulp.start(e.length>0?["setVars"].concat(e):[]);else if(/^rewrite$/.test(t)){process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Rewrite"]);var s=configurationOfRewriteOnArvs(),o=!/^ugly$/.test(s.uglyness),n=!/^multiple$/.test(s.times);isdist.NOT_DISTRIBUTION&&getAllNeededModules(["rewrite","writeTemp","writeDist","applyTemp","applyDist"]),logTaskName("rewrite {0}-{1} mode".format([o?"imBeauty":"imUgly",n?"one shot":"watching"])),mergingOnChanges(o,n),(o?logTaskEndBeauty:logTaskEndUgly)(n)}}),gulp.task("helpMe",function(){logHelp()}),gulp.task("scanProjects",function(){logTaskPurpose(this.currentTask.name),setConfig(),config.projects.forEach(function(e){getModule(M.fssync).exists(e.path+"\\config.mzg.json")||(console.log("file :"+logFilePath(e.path+"\\config.mzg.json")+" does not exist ... creation very soon"),gulp.src("custom/config_model.json").pipe(getModule(M.rename)("config.mzg.json")).pipe(gulp.dest(e.path)))})}),gulp.task("pulse",function(){process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Pulse !"]);var e=tasksToRunOnArgvs();isdist.NOT_DISTRIBUTION&&getAllNeededModules(e.concat(["setVars","pulse"])),setConfig(),gulp.start("clear"),gulp.start(e.length>0?["setVars"].concat(e):[]),coverFoldersToServe({scope:"*",shouldLog:!1});var t=getAllServiceCoverageWatchFolders(),s=getEveryFilesCoveredOnce(t);gloupslog("Applying services ... please wait"),console.log(" "+chalk.bgYellow(" ! ")+" Long process ... few secondes required"),fireEnventOnEveryCoveredFiles(s)}),gulp.task("serviceMapping",function(){logTaskPurpose(this.currentTask.name),config.verbose=!0,gulp.start(["setVars"])}),gulp.task("serve",["setParams"]),gulp.task("automin",function(){var e={module:"gulp-uglify",rules:[JS_REGEX_FILE_PATH_PATTERN,["!",/.*(?:.min.js|.lisence.js)$/]],lisences:null,mainPipe:null};e.mainPipe=getModule(M.lazyPipe)().pipe(getModule(M.uglify)).pipe(renameSuffixMin),runTaskProcessForCompression(this,config.pathesToJs,e)}),gulp.task("typescript",function(){var e={module:"gulp-typescript",rules:[/.*.ts$/],mainPipe:getModule(M.lazyPipe)().pipe(function(){return getModule(M.ts)({noImplicitAny:!0})}),realTargetsFunction:function(e,t){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToTs,e)}),gulp.task("coffeescript",function(){var e={module:"gulp-coffee",rules:[/.*.coffee$/],mainPipe:getModule(M.lazyPipe)().pipe(function(){return getModule(M.coffee)({bare:!0})}),realTargetsFunction:function(e,t){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToCoffee,e)}),gulp.task("autominCss",function(){var e={module:"gulp-clean-css",rules:[/^.*.css$/,["!",/^.*(?:.min.css|.lisence.css|.less|.scss|.map)$/]],lisences:null,mainPipe:null};e.mainPipe=getModule(M.lazyPipe)().pipe(autoprefix).pipe(cleanCssMinification).pipe(renameSuffixMin),runTaskProcessForCompression(this,config.pathesToStyle,e)}),gulp.task("less",function(){var e={module:"gulp-less",rules:[/.*.less$/],lisences:null,mainPipe:null,realTargetsFunction:function(e,t){return[e]}};e.mainPipe=getModule(M.lazyPipe)().pipe(function(){return getModule(M.less)({paths:[getModule(M.path).join(__dirname,"less","includes")]})}).pipe(autoprefix).pipe(getModule(M.stylefmt)),runTaskProcessForPrecompiledFiles(this,config.pathesToStyleLess,e)}),gulp.task("sass",function(){var e={module:"gulp-sass",rules:[/.*.scss$/],lisences:null,mainPipe:null,realTargetsFunction:function(e,t){return getMatchingPrincipalSCSS(t.projectPath,e.hackSlashes())}};e.mainPipe=getModule(M.lazyPipe)().pipe(function(){return getModule(M.sass)({indentedSyntax:!1}).on("error",getModule(M.sass).logError)}).pipe(autoprefix).pipe(getModule(M.stylefmt)),runTaskProcessForPrecompiledFiles(this,config.pathesToSass,e)}),gulp.task("stylus",function(){var e={module:"gulp-stylus",rules:[/.*.styl$/],mainPipe:getModule(M.lazyPipe)().pipe(function(){return getModule(M.stylus)({"include css":!0,linenos:!0})}).pipe(autoprefix).pipe(getModule(M.stylefmt)),realTargetsFunction:function(e,t){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToStylus,e)}),gulp.Gulp.prototype.__runTask=gulp.Gulp.prototype._runTask,gulp.Gulp.prototype._runTask=function(e){this.currentTask=e,this.__runTask(e)};
/* -- Provided wth Gloups v 6.3.1 - 06-19-2018 | thanks to gulp- uglify, replace, concat, insert -- */