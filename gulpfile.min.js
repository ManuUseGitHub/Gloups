/*!
 * copyright !
 * gvghvggc
 * ghvnfchfc
 * gfhdhfdbdfxbdf
 */
/*!ghvjgfchfcbdfxbdxvdswdswcswshfc gvjfhrtxgrdxgdx yjtdhertdgdxgbdxgbdxg fhfcbfcbfdxgfbdx*/
"use strict";var GLOUPS_VERSION="6.0";process.title="Gloups "+GLOUPS_VERSION+" | Chears !";var gulp=require("gulp"),chalk=require("chalk"),M={autoprefixer:"gulp-autoprefixer",cleanCSS:"gulp-clean-css",clear:"clear",coffee:"gulp-coffee",concat:"gulp-concat",del:"del",exit:"gulp-exit",fs:"fs",fssync:"fs-sync",insert:"gulp-insert",jsValidate:"gulp-jsvalidate",lazyPipe:"lazypipe",less:"gulp-less",nop:"gulp-nop",path:"path",rename:"gulp-rename",replace:"gulp-replace",sass:"gulp-sass",sourcemaps:"gulp-sourcemaps",stylefmt:"gulp-stylefmt",stylus:"gulp-stylus",through:"through2",ts:"gulp-typescript",uglify:"gulp-uglifyes",wait:"gulp-wait"},SERVICES={t:"typescript",c:"coffeescript",s1:"less",s2:"sass",s3:"stylus",minj:"automin",minc:"autominCss",tr:"transitive",es:"essential",a:"all",all:"automin typescript coffeescript autominCss less sass stylus",styles:"autominCss less sass stylus",js:"automin typescript coffeescript"},PRESET_OPTIONS="all|styles|js",SERVICES_OPTIONS="automin|autominCss|typescript|coffeescript|less|sass|stylus",SERVICES_ADVANCED_OPTIONS="transitive|essential",ALL_SERVICES_OPTIONS=PRESET_OPTIONS+"|"+SERVICES_OPTIONS+"|"+SERVICES_ADVANCED_OPTIONS,JS_REGEX_FILE_PATH_PATTERN="^(?:((?:[^\\.]+|..)[\\x2F\\x5C])|)((?:([^\\.^\\x2F^\\x5C]+)(?:((?:[.](?!\\bmin\\b)(?:[^\\.]+))+|))(?:([.]min)([.]js)|([.]js))))$",GLOUPS_OPTIONS=SERVICES_OPTIONS+"|"+PRESET_OPTIONS,SILENT_TASKS="watch|vet|unit-test|integration-test",ISALL=!0,isdist={},AUTOPREFIXER_BROWSERS=["> 1%","last 2 versions","firefox >= 4","safari 7","safari 8","IE 8","IE 9","IE 10","IE 11"],DEFAULT_CONFIG={verbose:!1,pathesToJs:[],pathesToTs:[],pathesToCoffee:[],pathesToStyle:[],pathesToStyleLess:[],pathesToSass:[],pathesToStylus:[],projects:[]},config=getConfig(),glob_found_modules={fs:!0},glob_visited_elements={infunc:{},intask:{}},bySetup=!0,stayBeautiful=!0,modifiedMZGEvent=null,gulpFileTempPath="supports/rewriting/gulpfile_temp.js",gulpFileTempPath2="supports/rewriting/gulpfile_temp2.js",pathFiles=[],RewriteServices={u:"ungly",b:"beauty",uglyness:"beauty",1:"once","*":"multiple",times:"once"},mzgFiles=["supports/basic/mzg_jshint_specifications.js","supports/rewriting/log_sections/mzg_log1.js","supports/basic/mzg_modules_importation.js","supports/basic/mzg_vars.js","supports/rewriting/mzg_rewriting_vars.js","supports/rewriting/log_sections/mzg_log15.js","supports/files/mzg_stable_reading_file_class.js","supports/rewriting/log_sections/mzg_log2.js","supports/basic/mzg_stable_funcs.js","supports/basic/mzg_modules_requesting.js","supports/rewriting/log_sections/mzg_log3.js","supports/basic/tasks/mzg_default_task.js","supports/basic/tasks/mzg_clear_task.js","supports/basic/tasks/mzg_externalize_config_task.js","projects_setup_tasks/mzg_set_vars_task.js","supports/basic/tasks/mzg_set_params_task.js","supports/basic/tasks/mzg_help_me_task.js","supports/rewriting/log_sections/mzg_log4.js","projects_setup_tasks/mzg_scan_projects_task.js","projects_setup_tasks/mzg_services_mapping_task.js","supports/rewriting/log_sections/mzg_log5.js","services_tasks/mzg_serve_task.js","supports/rewriting/log_sections/mzg_log6.js","services_tasks/js_tasks/mzg_automin_task.js","services_tasks/js_tasks/mzg_tyepscript_task.js","services_tasks/js_tasks/mzg_coffeescript_task.js","supports/rewriting/log_sections/mzg_log7.js","services_tasks/css_tasks/mzg_automin_css_task.js","services_tasks/css_tasks/mzg_less_task.js","services_tasks/css_tasks/mzg_sass_task.js","services_tasks/css_tasks/mzg_stylus_task.js","supports/rewriting/log_sections/mzg_log8.js","services_tasks/mzg_other_oriented_tasks.js","supports/rewriting/log_sections/mzg_log16.js","supports/files/mzg_module_seeking_funcs.js","supports/rewriting/log_sections/mzg_log9.js","services_tasks/mzg_tasks_micro_services.js","services_tasks/mzg_services_funcs.js","supports/rewriting/log_sections/mzg_log10.js","supports/rewriting/tasks/mzg_apply_temp_task.js","supports/rewriting/tasks/mzg_apply_dist_task.js","supports/rewriting/tasks/mzg_write_temp_task.js","supports/rewriting/tasks/mzg_write_dist_task.js","supports/rewriting/tasks/mzg_rewrite_task.js","supports/rewriting/log_sections/mzg_log11.js","supports/mzg_runtask.js","supports/rewriting/log_sections/mzg_log12.js","supports/files/configurationSetting/mzg_config_funcs.js","supports/projects/mzg_projects_funcs.js","supports/mzg_argument_funcs.js","supports/rewriting/log_sections/mzg_log13.js","supports/rewriting/mzg_rewriting_funcs.js","supports/rewriting/mzg_rewrite_arguments_func.js","supports/rewriting/log_sections/mzg_log14.js","supports/mzg_logging.js"],distFiles=mzgFiles.slice();distFiles.splice(50,3),distFiles.splice(38,6),distFiles.splice(33,2),distFiles.splice(13,1),distFiles.splice(9,1),distFiles.splice(4,1),isdist.NOT_DISTRIBUTION=!0;class classReading{constructor(){this.line_=null,this.data_=null,this.iter_=null,this.stopped_=!1}initialize(e,s){this.data_=e+" ",this.iter_=s,this.line_=[]}readLines(e){for(var s;!this.stopped&&(s=this.getNextChar());)/^[\n\r]$/g.test(s)||this.isEndReached()?(this.toLine(),e(this.line),this.resetLine()):this.feed(s)}stop(){this.stopped=!0}get stopped(){return this.stopped_}set stopped(e){this.stopped_=e}get iter(){return this.iter_}set iter(e){this.iter_=e}get data(){return this.data_}set data(e){this.data_=e}get line(){return this.line_}set line(e){this.line_=e}toLine(){this.line=this.line.join(""),this.line=this.line.replace(/^[\n\r]$/g,"")}resetLine(){this.line=[]}getNextChar(){return this.data[this.iter++]}isEndReached(){return!this.data[this.iter]}feed(e){this.line_.push(e)}}String.prototype.format=function(e){return this.replace(String.prototype.format.regex,function(s){var t=parseInt(s.substring(1,s.length-1));return t>=0?e[t]:-1===t?"{":-2===t?"}":""})},String.prototype.format.regex=new RegExp("{-?[0-9]+}","g"),String.prototype.hackSlashes=function(){return this.replace(/[\\]/g,"/")};var cmd=String(process.argv[2]);if(ISALL||new RegExp("^(({0})(:.*)?)$".format([SILENT_TASKS])).test(cmd)){var isWatching=/^(watch:.*)$/.test(cmd),firstCall=!1,on=gulp.on;gulp.on=function(e,s){if(!/^(task_start|task_stop)$/.test(e)||!/gutil\.log\(\s*'(Starting|Finished)/.test(s.toString()))return on.apply(gulp,arguments)},gulp.on("start",function(){firstCall&&(isWatching&&process.stdout.write(""),firstCall=!1)}),gulp.on("stop",function(){firstCall=!0})}function getModule(e){if("string"==typeof e)for(var s in M)if(M[s]==e){var t=new Date;M[s]=require(e);var i=ms2Time(new Date-t);return isdist.NOT_DISTRIBUTION&&console.log(forNowShortLog(" {0}{1} loaded after {2}".format([chalk.bgMagenta(" M:"),chalk.bgMagenta(e+" "),chalk.magenta(i)]))),M[s]}return e}var logOrig=console.log;function gloupslog(e){logOrig(e)}var mayLogEssentials=metAllArgs(["essential"]);function readCopyright(e){var s,t=new classReading,i=M.fs.readFileSync(e,"utf8");t.initialize(i,0);var n=!1,o=0,a=[],r=!1;return t.readLines(function(){s=t.line,r=!1,/^.*(?:\/\*!).*(?:\*\/).*$/.test(s)?r=!0:/^.*(?:\/\*!).*$/.test(s)?(r=!0,n=!0):n&&/^.*(?:\*\/).*$/.test(s)&&(r=!0,n=!1),n&&(s.length>0?r=!0:++o%3==2&&(r=!0),s.length>0&&(o=0)),r&&a.push(s)}),a.join("\n")}function getAllNeededModules(e){gloupslog("\n SYNTAXICALY {1} FROM {0} ...".format([logFilePath("gulpfile.js"),chalk.bgMagenta(" IMPORTING MODULES ")])),console.log("\n"),getModule(M.fs),seekInFoundElements("intask",JSON.stringify(e)),importModulesFromFoundModules()}function importModulesFromFoundModules(){var e=new Date;Object.keys(glob_found_modules).forEach(function(e){getModule(M[e])});var s=ms2Time(new Date-e);console.log("\n"),gloupslog(" SYNTAXICAL  {1} DONE IN {0}".format([chalk.magenta(s),chalk.bgMagenta(" IMPORT ")])),console.log("\n")}function importNeededModules(e,s){var t=/^(?:[\-]+(.*)|(.*))$/.exec(s);s=t[1]?t[1]:t[2],console.log("\n"),gloupslog(" SYNTAXICALY  {1} FROM {0} ...".format([logFilePath("gulpfile.js"),chalk.bgMagenta(" IMPORT MODULES ")])),console.log("\n"),getModule(M.fs);var i=getAnalyser();Macro_Seek_Modules(initReading(i.file),i,e,s),importModulesFromFoundModules()}function Macro_Seek_Modules(e,s,t,i){var n,o=0;e.readLines(function(){n=e.line.replace(/\r?\n|\r/g,""),defineMatchingElement(s,n,i),s[t]&&i=={intask:s.taskMatched,infunc:s.functMatched}[t]&&((o=n.split("{").length-1+(n.split("}").length-1))%2==0&&o>0?whenModuleMatched(n):(defineLimits(s,n,o),whenElementMatched(n)))})}function getAnalyser(){return{file:"gulpfile.js",intask:!1,infunc:!1,taskMatched:"",functMatched:"",encounter:0}}function initReading(e){var s=new classReading,t=M.fs.readFileSync(e,"utf8");return s.initialize(t,0),s}function defineMatchingElement(e,s,t){var i;(i=/^(?:(?:var[\s]+(\b.*\b)[\s=]+function[(].*)|(?:.*[\s]?function[\s]([^\s(]+).*))$/.exec(s))?(e.functMatched=i[1]?i[1]:i[2],e.infunc=!0):(i=/^gulp[.]task[(]["']([^\[\]]*)["'][,\s]*([\[](?:["'][\w]+["'][,\s]*)+[\]])?.*$/.exec(s))&&(e.taskMatched=i[1],e.intask=!0,s.split("{").length-1==0&&i[2]&&t==i[1]&&(e.intask=!1,seekInFoundElements("intask",i[2])))}function defineLimits(e,s,t){(t=s.split("{").length-1)>0&&(e.encounter+=t),(t=s.split("}").length-1)>0&&(e.encounter-=t,0==e.encounter&&(e.infunc=!1))}function whenElementMatched(e){var s;whenModuleMatched(e)||((s=/^.*[\.]pipe[(]([\w]+).*$/.exec(e))?/^function|gulp$/.test(s[1])||seekInFoundElements("infunc",s[1]):(s=/^.*gulp[\.]start[(](?:(?:.*([\[](?:["'][\w]+["'],?)+[\]]))|(?:.*["']([\w]+)["'])).*$/.exec(e))?seekInFoundElements("intask",s[1]?s[1]:s[2]):(s=/^[^\"]*[^\.]+(\b[^\.]+\b)[(].*$/.exec(e))&&seekInFoundElements("infunc",s[1]))}function whenModuleMatched(e){var s,t;if(t=/^.*M[\.]([\w]+).*$/.exec(e))for(var i=/M[\.]([\w]+)/g;s=i.exec(e);)glob_found_modules[s[1]]||(glob_found_modules[s[1]]=!0);return t}function seekInFoundElements(e,s){var t=[];/^([\[](?:["'][\w]+["'][,\s]*)+[\]])$/.test(s)?(s=s.replace(/[\']/g,'"'),t=JSON.parse(s)):t.push(s),t.forEach(function(s){if(!glob_visited_elements[e][s]){glob_visited_elements[e][s]=!0;var t=getAnalyser();Macro_Seek_Modules(initReading(t.file),t,e,s)}})}function runTaskProcessForCompression(e,s,t){logTaskPurpose(e.currentTask.name);var i=createMainLazyPipeObject(s,"Compressed    ",t.module),n=watchList(s);gulp.watch(n,function(e){var n=e.path;if(checkMultipleRules(n,["deleted"!==e.type].concat(t.rules))){i.forMatchingObj.path=n;var o=getMatchingEntryConfig(n,s);i.pathesDescr=o,i.process=t.mainPipe,consumePipeProcss(null,i,[n])}})}function runTaskProcessForPrecompiledFiles(e,s,t){logTaskPurpose(e.currentTask.name);var i=createMainLazyPipeObject(s,"Processed     ",t.module),n=watchList(s),o=getFreshTransitivity();gulp.watch(n,function(e){var n=e.path;if(checkMultipleRules(n,t.rules)){i.forMatchingObj.path=n;var a=getMatchingEntryConfig(n,s);i.process=t.mainPipe;var r=t.realTargetsFunction(n,a);consumePipeProcss(o,i,r)}})}function consumePipeProcss(e,s,t){var i=transitiveAndSourcemappingWrap(e,s);s.destCallBack=function(){return gloupslog(""),logChangedRealTargetedFiles(s,t),null!=e?e.dest:s.pathesDescr.dest},gulp.src(t).pipe(i()).pipe(gulp.dest(s.destCallBack()))}function logChangedRealTargetedFiles(e,s){var t,i=e.forMatchingObj.pathesDescr,n=e.message.action,o=0;if(s.length>1)s.forEach(function(e){o++>0&&(n="              "),t=getProjectNameWithFileFromPathDesc(i,e),gloupslog(" {0} '{1}{2}'".format([n,chalk.bgCyan(" "+t.projectName+" "),chalk.cyan(t.fileName+" ")]))});else{var a=s[0].hackSlashes();t=getProjectNameWithFileFromPathDesc(i,a),gloupslog(" {0} '{1}{2}'".format([n,chalk.bgCyan(" "+t.projectName+" "),chalk.cyan(t.fileName+" ")]))}}function getProjectNameWithFileFromPathDesc(e,s){var t=/[^\/\\]*(\/.*)/.exec(s)[1];t=".."+t;var i,n="<PROJECT NM>";for(var o in e){var a,r=e[o].projectPath.split("/").join("\\/")+"(.*)$";if(a=new RegExp(r,"g").exec(t)){n=e[o].projectName,i=a[1];break}}return{projectName:n,fileName:i}}function transitiveAndSourcemappingWrap(e,s){var t=s.process,i=s.forMatchingObj,n=i.path,o=i.pathesDescr,a=s.message,r=getMatchingEntryConfig(n,o);return setSourceMappingAndSign(transitiveWrapAround(e,r,n,t),r,a)}function setSourceMappingAndSign(e,s,t){var i=s.sourcemaps;return M.lazyPipe().pipe(i?M.sourcemaps.init:M.nop).pipe(e).pipe(insertSignatureAfter,t.action,t.module).pipe(i?function(){return M.sourcemaps.write("./")}:M.nop)}function transitiveWrapAround(e,s,t,i){null!=e&&"draft"==e.dest&&transitivitySetupCore(e,s,t);var n=null!=e?M.lazyPipe().pipe(transitivitySetup,e,s,t):M.nop,o=null!=e?M.lazyPipe().pipe(e.compressing).pipe(e.suffixing):M.nop;return M.lazyPipe().pipe(n).pipe(i).pipe(o)}function transitivitySetup(e,s,t){return M.through.obj(function(i,n,o){transitivitySetupCore(e,s,t),o(null,i)})}function transitivitySetupCore(e,s,t){var i=metAllArgs(["all","transitive"])||metAllArgs(["sass","mincss","transitive"])||metAllArgs(["stylus","mincss","transitive"])||metAllArgs(["less","mincss","transitive"])||metAllArgs(["coffee","minjs","transitive"])||metAllArgs(["typescript","minjs","transitive"]),n=!1;if(e.dest=s.dest,i){var o=/^.*[\/](.*)$/g.exec(t.hackSlashes())[1],a="{0}/{1}".format([s.dest,o]),r=/.*[.](coffee|ts)$/.test(o)?"JS":/.*[.](scss|styl|less)$/.test(o)?"CSS":"UNDEFINED",l=getMatchingEntryConfig(a,"JS"==r?config.pathesToJs:"CSS"==r?config.pathesToStyle:null);n=null!=l,e.should=n,n&&(e.compressing="JS"==r?M.uglify:"CSS"==r?cleanCssMinification:M.nop,e.suffixing=renameSuffixMin,e.dest=l.dest)}}function renameSuffixMin(){return M.rename({suffix:".min"})}function cleanCssMinification(){return M.cleanCSS({compatibility:"ie8"})}function insertSignatureAfter(e,s){return M.insert.append("\n/* -- {0} with Gloups {1} | using {2} -- */".format([e,GLOUPS_VERSION,s]))}function autoprefix(){return M.autoprefixer({browsers:AUTOPREFIXER_BROWSERS,cascade:!1})}function contains(e,s){for(var t=e.length;t--;)if(e[t]===s)return!0;return!1}function getMatchingPrincipalSCSS(e,s){var t=/^.*[\/\\](.*)$/.exec(s);if(t&&t[1]&&/^_.*$/.test(t[1])){var i=(t=/^(.*[\\\/])_?(.*)[.].*$/g.exec(s))[1]+t[2],n=e.length,o=pathEllipzizeing(i,0,s.substr(n).split("/").length),a=[],r=config.sassMaching;for(var l in r)contains(r[l].partials,o)&&a.push(r[l].target);return a}return[s]}function getFreshTransitivity(){return{should:!1,dest:"draft",compressing:M.nop,suffixing:M.nop}}function createMainLazyPipeObject(e,s,t){return{process:null,destCallBack:function(){return gulp.dest("draft")},forMatchingObj:{path:null,pathesDescr:e},message:{action:s,module:t,files:[]}}}function checkMultipleRules(e,s,t){var i=s[t=void 0!=t?t:0],n=!0;if(void 0!=i)if("boolean"==typeof i)n=n&&!!i&&checkMultipleRules(e,s,++t);else if("object"==typeof i)if(i instanceof Array)"string"==typeof i[1]&&(i[1]=new RegExp(i[1],"g")),n="!"==i[0]&&!i[1].test(e);else{if(!(i instanceof RegExp))return gloupslog(chalk.red("undefined case ...")),!1;n=n&&!!n&&checkMultipleRules(e,s,++t)}else{if("string"!=typeof i)return gloupslog(chalk.red("undefined case ...")),!1;n=(n=new RegExp(i,"g").test(e))&&!!n&&checkMultipleRules(e,s,++t)}return n}function getConfig(){return config||DEFAULT_CONFIG}function readJsonConfig(e){var s,t,i=M.fs.readFileSync(e,"utf8"),n=new classReading;n.initialize(i,0);var o=0,a=!0,r="",l=(s=/^(.*)(\.json)$/.exec(e))[1]+".temp"+s[2],c=s[1]+"2.temp"+s[2];M.fssync.write(l,"","utf8"),n.readLines(function(){t=n.line,(a=s=/^(.*)\/\/.*$/g.exec(t))?r=s[1]:(a=s=/^(.*)\/\*$/g.exec(t))?(r=s[1],++o):(a=s=/^.*\*\/(.*)$/g.exec(t))?(r=s[1],--o):(a=0==o)&&(r=t),a&&(/^[\s]*$/g.test(r)||(getModule(M.fs).appendFileSync(c,r+"\r\n","utf8"),getModule(M.fs).appendFileSync(l,/^[\s\t]*((?:[^\s\t]*[\s\t]*[^\s\t])+)[\s\t]*$/.exec(r)[1],"utf8")))});var g=getModule(M.fs).readFileSync(l,"utf8");return getModule(M.fssync).remove(l),getModule(M.fssync).remove(c),JSON.parse(g.replace(/}(,)]/g,"}]"))}function setConfig(){config.projects=readJsonConfig("custom/config.json").projects}function makePathesCoveringAllFilesFor(e,s,t,i){var n=s.addon,o=s.pathesToService;if(s.projectPath=e,n){for(var a=0,r=n.length;a<r;++a){n[a].watch=n[a].watch+t;n[a].watch,n[a].dest;0<a&&(i="[SAME-PURPOSE]");var l=getProjectNameFromRootPath(e);logServiceActivatedPushed(i,l,n[a]),n[a].watch=e+"/"+n[a].watch,n[a].dest=e+"/"+n[a].dest,n[a].projectPath=e,n[a].projectName=l,o=o.concat(n[a])}config.verbose&&console.log()}return o}function setUpProjectWatchingPaths(e){var s=readJsonConfig(e+"/config.mzg.json");console.log("Activated Services for target project under the path [FOLDER]:"),console.log(logFilePath(e)+"\n"),config.pathesToJs=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToJs,addon:s.minify_js},"/**/*.js","Compress .js files into .min.js files"),config.pathesToTs=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToTs,addon:s.ts_to_js},"/**/*.ts","Compile .ts files into .js file"),config.pathesToCoffee=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToCoffee,addon:s.coffee_to_js},"/**/*.coffee","Compile .coffee files into .js file"),config.pathesToStyle=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStyle,addon:s.minify_css},"/**/*.css","Compress .css files"),config.pathesToStyleLess=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStyleLess,addon:s.less},"/**/*.less","Compile .less files into .css files"),config.pathesToSass=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToSass,addon:s.sass},"/**/*.scss","Compile .scss files into .css files"),config.pathesToStylus=makePathesCoveringAllFilesFor(e,{pathesToService:config.pathesToStylus,addon:s.stylus},"/**/*.styl","Compile .styl files into .css files")}function getMatchingEntryConfig(e,s){for(var t in e=e.hackSlashes(),s){var i=s[t],n=i.watch.hackSlashes(),o=(i.dest.hackSlashes(),new RegExp("^([^\\\\/*]+).([^\\*]+)([\\/]?[\\/*]+[\\/]?)(.*)$","g").exec(n)[2]);if(new RegExp("^.*(?:"+o+").*$","g").exec(e))return i}return null}function watchList(e){var s=[];for(var t in e){var i=e[t].watch;s.push(i)}return s}function watchListLight(e){var s=[];return e.forEach(function(e){var t=e.watch,i=e.projectPath.length,n=t.substr(i);s.push({project:e.projectName,watch:n})}),s}function mappSassMatching(e,s){var t;if((t=/^(.*)[\\\/]\*\*[\\\/]\*\..*$/.exec(s))&&t[1]){config.sassMaching=[];var i=0;walkSync(t[1],[],new RegExp("^.*[\\/](_.*)$","i")).forEach(function(s){config.sassMaching.push({identifier:s.fileName,target:s.path,partials:[]}),pushEllipsizedPartials(e,s,i++)})}}function pushEllipsizedPartials(e,s,t){var i=new classReading,n=M.fs.readFileSync(s.path,"utf8");i.initialize(n,0);var o,a,r=e.length;i.readLines(function(){if(o=i.line,(a=/^@import[\s].*["](.*)["]/.exec(o))&&a[1]){var e="{0}/{1}".format([s.dir,a[1]]),n=pathEllipzizeing(e,0,e.substr(r).split("/").length);config.sassMaching[t].partials.push(n)}})}function pathEllipzizeing(e,s,t){var i="^(?:(?:((?:[^/\\]+[\\/]{-1}1,2{-2}){-1}{0}{-2}).*((?:[\\/][^/\\?]+){-1}{1},{-2}[\\/]?)[^?]*).*|([^?]*).*)$".format([s,t]),n=new RegExp(i,"g").exec(e);return n[3]?n[3]:n[1]+"..."+n[2]}mayLogEssentials&&(console.log=function(){},gloupslog(forNowShortLog(chalk.bgRed(" Logging only essential messages ")))),"--gulpfile"==process.argv[2]?process.argv[4]&&!/^serve|rewrite$/.test(process.argv[4])&&importNeededModules("intask",process.argv[4]):process.argv[2]&&!/^serve|rewrite$/.test(process.argv[2])&&importNeededModules("intask",process.argv[2]),gulp.task("default",["setParams"]),gulp.task("copyright",function(){var e={data:""};gulp.src("gulpfile.js").pipe(M.through.obj(function(s,t,i){e.data=readCopyright(s.path),i(null,s)})).pipe(M.uglify()).pipe(renameSuffixMin()).pipe(M.insert.prepend(function(){return""!=e.data?e.data+"\n":""})).pipe(gulp.dest("."))}),gulp.task("clear",function(){M.clear()}),gulp.task("externalizeConfig",function(e){M.fs.writeFile("config.json",JSON.stringify(config,null,4),e)}),gulp.task("setVars",function(){for(var e in setConfig(),isdist.NOT_DISTRIBUTION&&getModule(M.path),config.verbose||logTaskPurpose(this.currentTask.name),config.projects){var s=config.projects[e];M.fssync.exists(s.path+"\\config.mzg.json")?(console.log(" "+chalk.bgGreen(" "+s.project+" ")),s.checked&&setUpProjectWatchingPaths(s.path)):logProjectErrored(s)}for(e in config.pathesToSass){var t=config.pathesToSass[e].watch;mappSassMatching(config.pathesToSass[e].projectPath,t)}isdist.NOT_DISTRIBUTION&&(config.verbose||console.log(forNowLongLog("{0}\n",["config externalized under config.json"])),gulp.start("externalizeConfig")),config.verbose||(console.log(forNowLongLog("{0}\n",["config externalized under config.json"])),console.log(forNowLongLog("{0}\n",["CONFIGURATON PROCEEDED"])))}),gulp.task("setParams",function(){var e,s=this.seq.slice(-1)[0];if(/^default$/.test(s))e=tasksToRunOnArgvs(),gulp.start(e.length>0?["setVars"].concat(e):[]);else if(/^serve$/.test(s))process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Serve"]),e=tasksToRunOnArgvs(),isdist.NOT_DISTRIBUTION&&getAllNeededModules(e.concat(["setVars"])),gulp.start(e.length>0?["setVars"].concat(e):[]);else if(/^rewrite$/.test(s)){process.title="Gloups {0} | {1}".format([GLOUPS_VERSION,"Rewrite"]);var t=configurationOfRewriteOnArvs(),i=!/^ugly$/.test(t.uglyness),n=!/^multiple$/.test(t.times);isdist.NOT_DISTRIBUTION&&getAllNeededModules(["rewrite","writeTemp","writeDist","applyTemp","applyDist"]),logTaskName("rewrite {0}-{1} mode".format([i?"imBeauty":"imUgly",n?"one shot":"watching"])),mergingOnChanges(i,n),(i?logTaskEndBeauty:logTaskEndUgly)(n)}}),gulp.task("helpMe",function(){logHelp()}),gulp.task("scanProjects",function(){logTaskPurpose(this.currentTask.name),setConfig(),config.projects.forEach(function(e){M.fssync.exists(e.path+"\\config.mzg.json")||(console.log("file :"+logFilePath(e.path+"\\config.mzg.json")+" does not exist ... creation very soon"),gulp.src("custom/config_model.json").pipe(M.rename("config.mzg.json")).pipe(gulp.dest(e.path)))})}),gulp.task("serviceMapping",function(){logTaskPurpose(this.currentTask.name),config.verbose=!0,gulp.start(["setVars"])}),gulp.task("serve",["setParams"]),gulp.task("automin",function(){var e={module:"gulp-uglify",rules:[JS_REGEX_FILE_PATH_PATTERN,["!",/.*.min.js$/]],mainPipe:M.lazyPipe().pipe(M.uglify).pipe(renameSuffixMin)};runTaskProcessForCompression(this,config.pathesToJs,e)}),gulp.task("typescript",function(){var e={module:"gulp-typescript",rules:[/.*.ts$/],mainPipe:M.lazyPipe().pipe(function(){return M.ts({noImplicitAny:!0})}),realTargetsFunction:function(e,s){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToTs,e)}),gulp.task("coffeescript",function(){var e={module:"gulp-coffee",rules:[/.*.coffee$/],mainPipe:M.lazyPipe().pipe(function(){return M.coffee({bare:!0})}),realTargetsFunction:function(e,s){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToCoffee,e)}),gulp.task("autominCss",function(){var e={module:"gulp-clean-css",rules:[/^.*.css$/,["!",/^(?:.*.min.css|.*.less|.*.scss|.*.map)$/]],mainPipe:M.lazyPipe().pipe(autoprefix).pipe(cleanCssMinification).pipe(renameSuffixMin)};runTaskProcessForCompression(this,config.pathesToStyle,e)}),gulp.task("less",function(){var e={module:"gulp-less",rules:[/.*.less$/],mainPipe:M.lazyPipe().pipe(function(){return M.less({paths:[M.path.join(__dirname,"less","includes")]})}).pipe(autoprefix).pipe(M.stylefmt),realTargetsFunction:function(e,s){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToStyleLess,e)}),gulp.task("sass",function(){var e={module:"gulp-sass",rules:[/.*.scss$/],mainPipe:M.lazyPipe().pipe(function(){return M.sass({indentedSyntax:!1}).on("error",M.sass.logError)}).pipe(autoprefix).pipe(M.stylefmt),realTargetsFunction:function(e,s){return getMatchingPrincipalSCSS(s.projectPath,e.hackSlashes())}};runTaskProcessForPrecompiledFiles(this,config.pathesToSass,e)}),gulp.task("stylus",function(){var e={module:"gulp-stylus",rules:[/.*.styl$/],mainPipe:M.lazyPipe().pipe(function(){return M.stylus({"include css":!0,linenos:!0})}).pipe(autoprefix).pipe(M.stylefmt),realTargetsFunction:function(e,s){return[e]}};runTaskProcessForPrecompiledFiles(this,config.pathesToStylus,e)}),gulp.task("mapFonction",function(){importNeededModules()}),gulp.task("applyTemp",function(){gulp.watch(gulpFileTempPath,function(e){if(gulp.src(gulpFileTempPath).pipe(M.jsValidate())){console.log(forNowShortLog("{0} is {1}",[logFilePath("gulpfile.js"),chalk.green("validate")]));var s=new Date;gulp.src(gulpFileTempPath).pipe(M.insert.prepend('"use strict";\n')).pipe(M.rename("gulpfile.js")).pipe(gulp.dest(function(e){var t=ms2Time(new Date-s);return gloupslog(forNowShortLog("{0} replaced after {1}",[chalk.cyan("gulpfile.js"),chalk.magenta(t)])),getGulpfolderFromFileBase(e)})).pipe(("multiple"==RewriteServices.times?M.nop:M.exit)())}})}),gulp.task("applyDist",function(){gulp.watch(gulpFileTempPath2,function(e){if(gulp.src(gulpFileTempPath2).pipe(M.jsValidate())){var s=new Date;gulp.src(gulpFileTempPath2).pipe(M.rename("gulpfile.js")).pipe(M.insert.prepend("/*jshint esversion: 6 */\n/*jshint ignore:start */\n")).pipe(gulp.dest(function(e){var t=getGulpfolderFromFileBase(e),i=ms2Time(new Date-s);return console.log(forNowShortLog("Gulp project distribution generated under {0} after {1}",[logFilePath(t+"/dist"),chalk.magenta(i)])),t+"/dist"})).pipe(M.through.obj(function(e,s,t){M.fssync.copy("help.md","dist/help.md"),M.fssync.copy("custom/project_mapping_model.json","dist/custom/config.json"),M.fssync.copy("custom/config_model.json","dist/custom/config_model.json"),M.fssync.copy("package.json","dist/package.json"),M.fssync.copy("gloups.bat","dist/gloups.bat"),t(null,e)}))}})}),gulp.task("writeTemp",function(){var e=new Date,s="";gulp.src(mzgFiles).pipe(M.jsValidate())&&gulp.src(mzgFiles).pipe(M.insert.prepend(function(e){return s=/^.*[\/\\](?:gloups|gulp|dist)[\/\\](.*)/.exec(e.path)[1],/^.*log_sections.*$/.test(s)?"":"\n// -- [{0}] -- \n".format([s.hackSlashes()])})).pipe(M.concat(gulpFileTempPath)).pipe((stayBeautiful?M.nop:M.uglify)()).pipe(gulp.dest(function(s){var t=ms2Time(new Date-e);return console.log(forNowShortLog("{0} writen after {1}",[logFilePath(gulpFileTempPath),chalk.magenta(t)])),getGulpfolderFromFileBase(s)}))}),gulp.task("writeDist",function(){var e=new Date;gulp.src(distFiles).pipe(M.jsValidate())&&gulp.src(distFiles).pipe(M.concat(gulpFileTempPath2)).pipe(M.replace(/(getModule[(]M[\.][\w]+[)]+)/g,function(e){return/(M[\.][\w]+)/g.exec(e)[1]})).pipe(M.replace(/(M[\.][\w]+)/g,function(e){return"getModule({0})".format([e])})).pipe(M.uglify()).pipe(insertSignatureAfter("Provided","gulp- uglify, replace, concat, insert")).pipe(gulp.dest(function(s){var t=ms2Time(new Date-e);return console.log(forNowShortLog("{0} writen after {1}",[logFilePath(gulpFileTempPath2),chalk.magenta(t)])),getGulpfolderFromFileBase(s)}))}),gulp.task("rewrite",["setParams","applyTemp","applyDist"]),gulp.Gulp.prototype.__runTask=gulp.Gulp.prototype._runTask,gulp.Gulp.prototype._runTask=function(e){this.currentTask=e,this.__runTask(e)};var walkSync=function(e,s,t){var i=M.fs.readdirSync(e);return s=s||[],i.forEach(function(i){M.fs.statSync(M.path.join(e,i)).isDirectory()?s=walkSync(M.path.join(e,i),s,t):t.test(e+"/"+i)||s.push({dir:e.hackSlashes(),path:(e+"/"+i).hackSlashes(),fileName:i})}),s};function getProjectNameFromRootPath(e){var s=getConfig().projects;for(var t in s)if(e==s[t].path)return s[t].project;return e}function translateAliassesInArgs(e,s){var t,i=[];return e.forEach(function(e){(t=/^-([^\-]+)$/.exec(e))?i.push("--"+s[t[1]]):i.push(e)}),i}function getSliceOfMatchingOptions(e,s){var t=0,i=0;try{e.forEach(function(e){if(!new RegExp("^--("+s+")$","g").test(e)){if(t!=i)throw{};t++}i++})}catch(e){}return e.slice(t,i)}function metAllArgs(e){var s="";getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,SERVICES),ALL_SERVICES_OPTIONS).forEach(function(e,t){var i=new RegExp("^--(.*)$","g").exec(e)[1];0!=t&&(s+="|"),s+=i});var t=!1;for(var i in e){var n=e[i];if(!new RegExp("^("+s+")$","g").test(n)){t=!0;break}}return!t}function tasksToRunOnArgvs(){var e=[],s=[],t=0,i=getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,SERVICES),GLOUPS_OPTIONS);for(var n in i){try{n=/^[\-][\-]?([^\-]+)$/.exec(i[n])[1],new RegExp("^\\b("+PRESET_OPTIONS+")\\b$").test(n)?(checkPresetsOverdose(++t,n),e=SERVICES[n].split(" ")):e.push(n)}catch(t){if(s.push(t+" Error with option: "),/^GRAVE ERROR.*$/.test(t)){e=[];break}}t++}return logErrorsOnTaskArgvs(s),e}function checkPresetsOverdose(e,s){if(e>1)throw"GRAVE ERROR: Presets should be alone : "+s}var merging=function(e){M.clear(),e&&(modifiedMZGEvent=e);new Date;bySetup||(console.log(),console.log(forNowShortLog("CHANGING {0} ...",[logFilePath("gulpfile.js")])),console.log("FIRED BY {0} ...\n".format([logFilePath(e.path)]))),bySetup=!1,gulp.start(["writeTemp","writeDist"])},mergingOnChanges=function(e,s){console.log("  concats these files:"),mzgFiles.forEach(function(e,s){console.log("    ("+s+")"+logFilePath(e))}),console.log("to make this file:\n{0} - the file used by gulp".format([logFilePath("gulpfile.js")])),s?(stayBeautiful=e,merging()):gulp.watch(mzgFiles,function(e){merging(e)})};function getGulpfolderFromFileBase(e){return/^(.*[\/\\](?:gloups|gulp|dist))[\/\\].*/.exec(e.base)[1]}function configurationOfRewriteOnArvs(){var e;return getSliceOfMatchingOptions(translateAliassesInArgs(process.argv,RewriteServices),"ugly|beauty|once|multiple").forEach(function(s){try{var t=/^--(.*)$/.exec(s);t&&(e=t[1])&&(RewriteServices.uglyness="ugly"==e?e:RewriteServices.uglyness,RewriteServices.times="multiple"==e?e:RewriteServices.times)}catch(e){}}),{times:RewriteServices.times,uglyness:RewriteServices.uglyness}}function breath(){return"           "}function logFilePath(e){return"'{0}'".format([chalk.cyan(e)])}function logHelp(){var e,s,t=M.fs.readFileSync("help.md","utf8"),i=new classReading;i.initialize(t,0);var n=0;console.log("\n\n"),i.readLines(function(){s=i.line.replace(/\r?\n|\r/g,""),(e=/^([\s]*[#]+.*)$/.exec(s))?console.log(chalk.cyan(e[1])):(e=/^([\s]*)([$](?:[\s][^\s]+)+)([\s]{2,}.*|.*)$/.exec(s))?console.log("{0}{1}{2}".format([chalk.grey(e[1]),e[2],chalk.green(e[3])])):(e=/^([\s]*[>].*)$/.exec(s))?console.log(chalk.green(e[1])):(e=/^([\s]*)([\-]+[^\s,]+)([^\-.]*)((?:[\s][\-]+[^\s]+)+)([^\-.]*)((?:[.][^.\s]+)+|)([^\-.]*)((?:[.][^.\s]+)+|)(.*)$/.exec(s))?console.log("{0}{1}{2}{3}{4}{5}{6}{7}{8}".format([chalk.grey(e[1]),e[2],chalk.grey(e[3]),e[4],chalk.grey(e[5]),chalk.magenta(e[6]),chalk.grey(e[7]),chalk.magenta(e[8]),chalk.grey(e[9])])):(e=/^([^\-]*)((?:[\-]+[^\s]+[\s]?)+)([\s]?.*)$/.exec(s))?console.log("{0}{1}{2}".format([chalk.grey(e[1]),e[2],chalk.grey(e[3])])):s.length>0?console.log(chalk.grey(s)):++n%3==2&&console.log(s),s.length>0&&(n=0)})}function logErrorsOnTaskArgvs(e){e.length>0&&console.log("{0}\n{1}\n{2}\n{3}".format(chalk.red(e.join("\n"))),["WARNING \n\nYou may have made mistakes in shoosing wrong options.","call the folowing command to have more info of what options are valid","gulp --help"])}function logProjectErrored(e){gloupslog(" {0}  - SOMETHING IS WRONG \n".format([chalk.bgRed(" "+e.project+" ")])),gloupslog(" {0} {1}\n".format([logFilePath(e.path+"/config.mzg.json"),chalk.red(": MISMATCH")])),console.log(getColoredParagraph(" The path to that folder does not match to an actual project root folder containing a config.mzg.json file.",chalk.bgRed)+"\n\n {0}\n".format([chalk.bgWhite.black(" SOLUTION ")])+"\n"+getColoredParagraph(" ",chalk.bgWhite.grey)+getColoredParagraph(" Check the path to see if there is no mistake and fix it in the project definition.",chalk.bgWhite.grey)+"\n"+getColoredParagraph(" ",chalk.bgWhite.grey)+getColoredParagraph(" You can otherwise run the command to set up a configuration file at this path and also create nonexistent folders :",chalk.bgWhite.grey)+"\n"+getColoredParagraph(" $ gulp scanProjects",chalk.bgWhite.black)+getColoredParagraph(" ",chalk.bgWhite.grey))}function getColoredParagraph(e,s){var t=process.stdout.columns;return s(e+Array(t-e.length%t).join(" "))}function logProcessCompleteOnFile(e,s,t){try{var i=new Date;t();var n=ms2Time(new Date-i);e.length>1?(console.log(forNowShortLog("{0} of these files:\n".format([s]))),e.forEach(function(e){console.log(logFilePath(e))}),console.log(),console.log(forNowShortLog("after {0}".format([chalk.magenta(n)])))):console.log(forNowShortLog("{0} {1} after {2}".format([logFilePath(e),s,chalk.magenta(n)])))}catch(e){console.log(chalk.red(e))}}function ms2Time(e){var s,t,i;return[(i=Math.floor((t=Math.floor((s=Math.floor((e=Math.floor(e%1e3))/1e3%60))%60))%24))?i+"h ":"",t?t+"min ":"",s?s+"sec ":"",e,"ms"].join("")}function dateComputed(){var e=new Date;return[["Mon","Tues","Wednes","Thirth","Fri","Satur","Sun"][e.getDay()-1],"day,",[e.getMonth()+1,e.getDate(),e.getFullYear()].join("-")].join("")}function timeComputed(){var e=new Date;return[e.getHours(),e.getMinutes(),e.getSeconds()].join(":")}function forNowLongLog(e,s){return"[{0}] {1}".format([chalk.gray(dateComputed()),e.format(s)])}function forNowShortLog(e,s){var t=e.format(s);return"[{0}] {1}".format([chalk.gray(timeComputed()),t])}function logServiceActivatedPushed(e,s,t){if(config.verbose){var i;(i=/^([^.]+)([.][^\s]*)([^.]+)([.][^\s]*)([^.]+)$/.exec(e))?console.log("{0}{1}{2}{3}{4}".format([chalk.grey(i[1]),chalk.magenta(i[2]),chalk.grey(i[3]),chalk.magenta(i[4]),chalk.grey(i[5])])):(i=/^([^.]+)([.][^\s]*)([^.]+)$/.exec(e))&&console.log("{0}{1}{2}".format([chalk.grey(i[1]),chalk.magenta(i[2]),chalk.grey(i[3])])),console.log(" Watch :'{0}{1}'\n Dest. :'{2}{3}'".format([chalk.bgCyan(" "+s+" "),chalk.cyan("/"+t.watch+" "),chalk.bgCyan(" "+s+" "),chalk.cyan("/"+t.dest+" ")]));var n=t.sourcemaps;void 0!==n&&console.log(n?"         "+chalk.bgGreen(" Sourcemaps ! "):"")}}function logTaskPurpose(e){logTaskName(e);var s={setVars:"  Sets configuration variables \n  See the mapping file to set Gloups able to serve your projects here :\n  > "+logFilePath("custom/config.mzg.ini")+":\n",automin:"  Will uglify .js files matching the folowing path(s):\n",typescript:"  Will compile .ts files matching the folowing path(s):\n",coffeescript:"  Will compile .coffee files matching the folowing path(s):\n",autominCss:"  Will compress .css files matching the folowing path(s):\n",less:"  Will process .less files matching the folowing path(s):\n",sass:"  Will process .sass files matching the folowing path(s):\n",stylus:"  Will process .styl files matching the folowing path(s):\n",scanProjects:"  Creates configuration file in every project root folder\n"};s[e]?(console.log(s[e]),logWatchList(e)):console.log(chalk.yellow("  no information provided \n"))}function logWatchList(e){var s={automin:config.pathesToJs,typescript:config.pathesToTs,coffeescript:config.pathesToCoffee,autominCss:config.pathesToStyle,less:config.pathesToStyleLess,sass:config.pathesToSass,stylus:config.pathesToStylus};s[e]&&(watchListLight(s[e]).forEach(function(e,s){console.log("    '{0}{1}'".format([chalk.bgCyan(" "+e.project),chalk.cyan(e.watch+" ")]))}),console.log())}function logTaskName(e){console.log("\n {0}{1}\n".format([chalk.bgWhite.black(" T:"),chalk.bgWhite.black(e+" ")]))}function logTaskEndUgly(e){console.log("      > which is uglyfied "+chalk.red("for performances")),e?console.log("  once: "+chalk.red("not watching specific files")+"\n"):console.log()}function logTaskEndBeauty(e){console.log("      > which is beautifull "+chalk.red("for debugging")+"\n"),e?console.log("  once: "+chalk.red("not watching specific files")+"\n"):console.log()}